<script>
  // æª¢æŸ¥è¦–çª—å¯¬åº¦æ˜¯å¦å¤§æ–¼ 600ï¼Œå¦‚æœæ˜¯å°±å°å‘ index.html
  if (screen.width > 600 && !location.pathname.includes("index.html")) {
    location.href = "index.html" + location.search;
  }
</script>
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
	<script src="svg3DTagCloud.js"></script>
    <title>æ¡ƒåœ’TRPGæ¨å»£æœƒç³»çµ±ä»‹ç´¹</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f5f5f5;
        }

        .container {
            width: 80%;
            margin: 20px auto; /* èª¿æ•´å®¹å™¨çš„é ‚éƒ¨é–“è·å’Œæ°´å¹³å±…ä¸­ */
        }

        .header-container, .date-container, .content-container {
            width: 100%;
            padding: 20px;
            text-align: center;
            background-color: #97FFFF;
            border: 1px solid #ddd;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }

        .content-container {
            display: flex; /* ä½¿å…§å®¹éƒ¨åˆ†ç‚ºå½ˆæ€§ä½ˆå±€ */
            flex-direction: column; /* åˆå§‹ç‚ºç¸±å‘ä½ˆå±€ */
            align-items: center; /* ä½¿å…§éƒ¨å…§å®¹å±…ä¸­ */
			max-width: 96%; /* ç¡®ä¿çˆ¶å®¹å™¨çš„å®½åº¦ä¸è¶…è¿‡é¡µé¢ */

        }

        .image-section {
            display: flex; /* ä½¿ç”¨ Flexbox ä½¿åœ–ç‰‡ä¸¦æ’ */
            justify-content: space-between; /* ç¢ºä¿åœ–ç‰‡ä¹‹é–“çš„é–“è· */
            width: 100%; /* ç¢ºä¿åœ–ç‰‡å€å¡Šä½”æ»¿çˆ¶å®¹å™¨å¯¬åº¦ */
            gap: 10px; /* è¨­ç½®åœ–ç‰‡ä¹‹é–“çš„é–“éš” */
            margin-bottom: 15px;
        }

        .image-section img {
            max-width: 50%; /* åœ–ç‰‡æœ€å¤§å¯¬åº¦ç‚ºçˆ¶å®¹å™¨çš„ä¸€åŠ */
            width: 100%; /* ç¢ºä¿åœ–ç‰‡å¯¬åº¦å……æ»¿å®¹å™¨ */
            flex: 1; /* è®“åœ–ç‰‡å„è‡ªå ä¸€åŠå¯¬åº¦ */
            border-radius: 10px;
        }

        .text-section {
            display: flex;
            flex-direction: column;
            justify-content: center;
            text-align: left; /* æ–‡å­—éƒ¨åˆ†å·¦å°é½Š */
            width: 100%; /* ç¢ºä¿æ–‡å­—å€å¡Šä½”æ»¿çˆ¶å®¹å™¨å¯¬åº¦ */
        }

        .quote {
            font-style: italic;
            font-size: 1.2em;
            color: #555;
            margin-bottom: 10px;
            white-space: pre-line;
        }

        .main-text {
            font-size: 1em;
            line-height: 1.6;
            color: #333;
            margin-bottom: 15px;
            white-space: pre-line;
        }

        .signature {
            font-family: 'Courier New', Courier, monospace;
            font-size: 0.9em;
            color: #888;
            text-align: right;
            margin-top: 20px;
            white-space: pre-line;
        }

        .tab-container {
            margin-bottom: 20px;
            text-align: center;
        }

        .tab {
            cursor: pointer;
            padding: 10px;
            margin: 5px;
            background-color: #8DEEEE;
            border-radius: 5px;
            display: inline-block;
        }

        .tab.active {
            background-color: #5F9EA0;
            font-weight: bold;
        }

        .tab-content {
            display: none; /* é»˜è®¤éšè—å†…å®¹ */
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background-color: #f9f9f9;
			max-width: 96%; /* ç¡®ä¿çˆ¶å®¹å™¨çš„å®½åº¦ä¸è¶…è¿‡é¡µé¢ */

        }

        .tab-content.active {
            display: block; /* æ¿€æ´»çŠ¶æ€æ˜¾ç¤ºå†…å®¹ */
        }
		
        .event-item {
            margin: 10px 0;
            padding: 10px;
            background-color: #79CDCD;
            border-radius: 5px;
        }

        .events-container, .systems-container {
            margin-top: 20px;
        }

        a.event-link, a.system-link {
            text-decoration: none; /* ç§»é™¤é»˜èªçš„è¶…é€£çµä¸‹åŠƒç·š */
            color: inherit; /* ä½¿ç”¨é»˜èªæ–‡å­—é¡è‰² */
            display: block; /* è®“æ•´å€‹å€å¡Šå¯é»æ“Š */
        }
		
		a.event-link:hover {
			background-color: #B0E0E6; /* æ‚¬åœæ—¶çš„èƒŒæ™¯é¢œè‰² */
		}

		a.event-link.active {
			background-color: #5F9EA0; /* æ¿€æ´»çŠ¶æ€çš„èƒŒæ™¯é¢œè‰² */
			color: #fff; /* æ¿€æ´»çŠ¶æ€çš„æ–‡æœ¬é¢œè‰² */
			font-weight: bold; /* æ¿€æ´»çŠ¶æ€çš„æ–‡æœ¬åŠ ç²— */
		}
		
		#backToTopBtn {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background-color: rgba(0, 0, 0, 0.5);
            color: white;
            border: none;
            padding: 10px 20px;
            cursor: pointer;
            border-radius: 5px;
            display: none; /* Initially hidden */
        }
		
		.system-image{
            max-width: 50%; /* åœ–ç‰‡æœ€å¤§å¯¬åº¦ç‚ºçˆ¶å®¹å™¨çš„ä¸€åŠ */
            width: 100%; /* ç¢ºä¿åœ–ç‰‡å¯¬åº¦å……æ»¿å®¹å™¨ */
            flex: 1; /* è®“åœ–ç‰‡å„è‡ªå ä¸€åŠå¯¬åº¦ */
            border-radius: 10px;
        }
		
		/* è®“ 3D æ–‡å­—é›²çš„å®¹å™¨ `#word-cloud` æ ¹æ“šçˆ¶ç‰©ä»¶å¤§å°è®ŠåŒ– */
		#word-cloud {
			width: 100%; /* è®“å¯¬åº¦è·Ÿéš¨çˆ¶å®¹å™¨ */
			height: 100%; /* è®“é«˜åº¦æ ¹æ“šå…§å®¹è®ŠåŒ– */
			max-height: 600px;
			background: #111; /* æ·±è‰²èƒŒæ™¯ï¼Œè®“ 3D æ–‡å­—é›²æ›´æ˜é¡¯ */
			overflow: hidden;
		}

		/* è®“ `svg` å…§å®¹ä¹Ÿè‡ªé©æ‡‰ */
		#word-cloud svg {
			width: 100%;
			height: 100%;
			display: block;
		}
		#word-cloud-container {
			position: relative;
			display: inline-block;
			width: 100%;
		}
		#toggle-buttons {
			position: absolute;
			top: 50%;
			right: 10px;
			transform: translateY(-50%);
			display: flex;
			flex-direction: column;
			gap: 20px;
		}
		#toggle-buttons button {
			background: rgba(100, 0, 147, 0.5); /* åŠé€æ˜é»‘è‰² */
			color: white;
			border: none;
			padding: 10px 15px;
			cursor: pointer;
			border-radius: 5px;
			font-size: 14px;
		}

		#toggle-buttons button:hover {
			background: rgba(0, 0, 0, 0.8);
		}
		/* âœ… é€šç”¨ active æ¨£å¼ */
		#systems-container td.active {
			background: #5F9EA0 !important; /* æ·±è‰²èƒŒæ™¯ */
			color: #fff !important; /* ç™½è‰²æ–‡å­— */
			font-weight: bold; /* åŠ ç²— */
			border: 2px solid #4682B4; /* å¤–æ¡†æ›´æ˜é¡¯ */
		}
    </style>
</head>
<body>

<div class="container">
	<a href="https://sleepyknife.github.io/tyntrpg_system/" target="_blank">
		<!-- æ¨™é¡Œå€å¡Š -->
		<div class="header-container">
			<h1>æ¡ƒåœ’TRPGæ¨å»£æœƒç³»çµ±ä»‹ç´¹</h1>
		</div>
	</a>

    <!-- æ ‡ç­¾é¡µå®¹å™¨ -->
    <div class="tab-container">
        <span class="tab active" data-tab="system-overview">ç³»çµ±ä»‹ç´¹ç¸½è¡¨</span>
        <span class="tab" data-tab="event-details">æ´»å‹•æ—¥æœŸä»‹ç´¹</span>
    </div>

    <!-- ç³»ç»Ÿä»‹ç´¹æ€»è¡¨å†…å®¹ -->
    <div id="system-overview" class="tab-content active">
        <h2>ç³»çµ±ä»‹ç´¹ç¸½è¡¨</h2>
        <!-- ç³»ç»Ÿä»‹ç´¹æ€»è¡¨çš„å†…å®¹å¯ä»¥æ”¾åœ¨è¿™é‡Œ -->
        <p>é€™è£¡é¡¯ç¤ºç³»çµ±ä»‹ç´¹çš„ç¸½è¡¨å†…å®¹ã€‚æŒçºŒæ•´ç†ä¸­ã€‚(à¹‘â€¢Ì â‚ƒ â€¢Ì€à¹‘)</p>
		<p>é»é¸ç³»çµ±æœƒè‡ªå‹•è·³åˆ°è©²ç³»çµ±ä»‹ç´¹ï¼Œä¸‹é¢ShowAllå‰‡æœƒé¡¯ç¤ºå…¨éƒ¨å…§å®¹~</p>
		<p>(åŸæœ¬è¦ºå¾—åˆ—è¡¨çœ‹èµ·ä¾†å¤ªç„¡èŠè®“å®ƒå‹•èµ·ä¾†ï¼Œçµæœçœ‹ä¹…æœ‰é»æƒ³å(Â´ï½¥Ï‰ï½¥`)</p>
		
		<!-- Display Cloud Words -->
		<div id="word-cloud-container">
			<div id="word-cloud"></div>
			<div id="toggle-buttons">
				<button id="toggle-text">é¡¯ç¤ºæ–‡å­—</button>
				<button id="toggle-image">é¡¯ç¤ºåœ–ç‰‡</button>
				<button id="toggle-chaos">0k{8&Gn|</button>
			</div>
		</div>
		
		<!-- åŠ¨æ€ç”Ÿæˆçš„ç³»ç»Ÿæ ‡ç­¾åŒº -->
        <div id="systems-container">
            <!-- è¿™é‡Œå°†é€šè¿‡ JavaScript åŠ¨æ€ç”Ÿæˆç³»ç»Ÿæ ‡ç­¾ -->
        </div>
		
		<!-- å†…æ–‡åŒºå—ï¼Œåˆ†ä¸ºå›¾ç‰‡å’Œæ–‡å­— -->
        <div class="content-container" id="system-content-container" style="display: none;">
            <!-- æ–°å¢çš„æ ‡é¢˜åŒºå— -->
            <h2 id="system-title" style="text-align: center; margin-bottom: 25px;"></h2>
            
            <!-- å›¾ç‰‡åŒºå— -->
            <div class="image-section" id="system-image-section">
                <img src="" alt="ç¤ºä¾‹å›¾ç‰‡" id="system-image1">
                <img src="" alt="ç¤ºä¾‹å›¾ç‰‡2" id="system-image2">
            </div>

            <!-- æ–‡å­—åŒºå— -->
            <div class="text-section">
                <p class="quote" id="system-quote">è¿™é‡Œæ˜¯å¼•è¨€éƒ¨åˆ†ã€‚</p>
                <p class="main-text" id="system-main-text">è¿™é‡Œæ˜¯å†…æ–‡çš„æ–‡å­—èŒƒä¾‹ã€‚</p>
                <p class="signature" id="system-signature">ç­¾åéƒ¨åˆ†</p>
            </div>
        </div>
		
		<!-- åŠ¨æ€ç”Ÿæˆçš„ç³»ç»Ÿè¯¦ç»†ä¿¡æ¯å®¹å™¨ -->
		<div id="dynamic-system-container"></div>
    </div>

    <!-- æ´»åŠ¨æ—¥æœŸå†…å®¹ä»‹ç´¹ -->
    <div id="event-details" class="tab-content">
        <h2>æ´»å‹•æ—¥æœŸä»‹ç´¹</h2>
        <!-- åŠ¨æ€ç”Ÿæˆçš„åˆ†ç±»æ ‡ç­¾åŒº -->
        <div id="categories-container">
            <!-- è¿™é‡Œå°†é€šè¿‡ JavaScript åŠ¨æ€ç”Ÿæˆåˆ†ç±»æ ‡ç­¾ -->
        </div>

        <!-- æ´»åŠ¨æ˜¾ç¤ºåŒº -->
        <div class="events-container" id="events-container">
            <!-- æ ¹æ®ç‚¹å‡»çš„æ ‡ç­¾æ¥æ˜¾ç¤ºç›¸åº”çš„æ´»åŠ¨ -->
        </div>

        <!-- å…§æ–‡å€å¡Šï¼Œåˆ†ç‚ºåœ–ç‰‡å’Œæ–‡å­— -->
        <div class="content-container" id="content-container" style="display: none;">

            <!-- æ–°å¢çš„æ¨™é¡Œå€å¡Š -->
            <h2 id="event-title" style="text-align: center; margin-bottom: 25px;"></h2>

            <!-- åœ–ç‰‡å€å¡Š -->
            <div class="image-section" id="image-section">
                <img src="" alt="ç¤ºä¾‹åœ–ç‰‡" id="event-image">
                <img src="" alt="ç¤ºä¾‹åœ–ç‰‡2" id="event-image-2">
            </div>

            <!-- æ–‡å­—å€å¡Š -->
            <div class="text-section">
                <!-- å¼•è¨€éƒ¨åˆ† -->
                <p class="quote" id="event-quote">é€™è£¡æ˜¯å¼•è¨€éƒ¨åˆ†ã€‚</p>
                <!-- å…§æ–‡éƒ¨åˆ† -->
                <p class="main-text" id="event-main-text">é€™è£¡æ˜¯å…§æ–‡çš„æ–‡å­—ç¯„ä¾‹ã€‚</p>
                <!-- ç°½åéƒ¨åˆ† -->
                <p class="signature" id="event-signature">ç°½åéƒ¨åˆ†</p>
            </div>
        </div>
    </div>	
</div>
	<button id="backToTopBtn">å›åˆ°æœ€ä¸Šé¢</button>

<script>
    // æ ‡ç­¾é¡µåˆ‡æ¢é€»è¾‘
    const tabs = document.querySelectorAll('.tab');
    const tabContents = document.querySelectorAll('.tab-content');

    tabs.forEach(tab => {
        tab.addEventListener('click', function () {
            // ç§»é™¤æ‰€æœ‰æ ‡ç­¾çš„æ¿€æ´»çŠ¶æ€
            tabs.forEach(t => t.classList.remove('active'));
            // éšè—æ‰€æœ‰æ ‡ç­¾é¡µå†…å®¹
            tabContents.forEach(tc => tc.classList.remove('active'));

            // æ¿€æ´»å½“å‰æ ‡ç­¾å¹¶æ˜¾ç¤ºå¯¹åº”å†…å®¹
            tab.classList.add('active');
            const contentId = tab.getAttribute('data-tab');
            document.getElementById(contentId).classList.add('active');
        });
    });
	
	function activateTab(tabName, shouldScrollToContent = false) {
		// ç§»é™¤æ‰€æœ‰æ ‡ç­¾çš„æ¿€æ´»çŠ¶æ€
		tabs.forEach(t => t.classList.remove('active'));
		// éšè—æ‰€æœ‰æ ‡ç­¾é¡µå†…å®¹
		tabContents.forEach(tc => tc.classList.remove('active'));

		// æ¿€æ´»æŒ‡å®šæ ‡ç­¾å¹¶æ˜¾ç¤ºå¯¹åº”å†…å®¹
		const targetTab = Array.from(tabs).find(tab => tab.getAttribute('data-tab') === tabName);
		const targetContent = document.getElementById(tabName);

		if (targetTab && targetContent) {
			targetTab.classList.add('active');
			targetContent.classList.add('active');
			
			// å¦‚æœéœ€è¦æ»šåŠ¨åˆ° content-container
			if (shouldScrollToContent && tabName === 'event-details') {
				const contentContainer = document.getElementById('content-container');
				contentContainer.scrollIntoView({ behavior: 'smooth' });
			} else if (shouldScrollToContent && tabName === 'system-overview') {
                const systemContentContainer = document.getElementById('system-content-container');
                systemContentContainer.scrollIntoView({ behavior: 'smooth' });
            }
		}
	}

	// æ·»åŠ æ ‡ç­¾é¡µç‚¹å‡»äº‹ä»¶
	tabs.forEach(tab => {
		tab.addEventListener('click', function () {
			const contentId = tab.getAttribute('data-tab');
			activateTab(contentId);
		});
	});

    // å…¨å±€è®Šé‡ä¾†å­˜å„²è®€å–çš„äº‹ä»¶è³‡æ–™
    let systemData = [];
    let eventsData = [];
    let uniqueCategories = new Set();
    const paramsOnLoad = new URLSearchParams(window.location.search);

    // è¯»å– system.json æ–‡ä»¶å¹¶å­˜å‚¨ç³»ç»Ÿèµ„æ–™
    const fetchSystemData = fetch('data/system.json')
        .then(response => response.json())
        .then(data => {
            systemData = data.details;
            generateSystemTabs(systemData);
            displayAllSystems(); // é»˜è®¤æ˜¾ç¤ºæ‰€æœ‰ç³»ç»Ÿè¯¦ç»†ä¿¡æ¯
        })
        .catch(error => {
            console.error('è¯»å–ç³»ç»Ÿèµ„æ–™æ—¶å‡ºé”™:', error);
        });

    // è®€å–æ–°çš„ events.json æ–‡ä»¶
    const fetchEventsData = fetch('data/events.json')
        .then(response => response.json())
        .then(data => {
            eventsData = data.events;
            generateCategoryTabs(eventsData);
        })
        .catch(error => {
            console.error('è®€å–äº‹ä»¶è³‡æ–™æ™‚å‡ºéŒ¯:', error);
        });

    // ç­‰å¾…æ‰€æœ‰æ•¸æ“šè®€å–å®Œæˆå¾ŒåŸ·è¡Œåˆå§‹åŒ–
    Promise.all([fetchSystemData, fetchEventsData]).then(() => {
        // è®€å–å®Œå¾Œï¼Œæª¢æŸ¥åƒæ•¸
        const date = paramsOnLoad.get('date');
        const masterId = paramsOnLoad.get('master');
        const system = paramsOnLoad.get('system');

        if (date && masterId) {
            document.getElementById('content-container').style.display = 'block';
            displayEventsByDate(date); // æ˜¾ç¤ºè¯¥æ—¥æœŸä¸‹çš„äº‹ä»¶
            displayDetailsByDate(date, masterId); // è‡ªåŠ¨æ˜¾ç¤ºè¯¦ç»†ä¿¡æ¯

            // è‡ªåŠ¨åˆ‡æ¢åˆ°â€œæ´»åŠ¨æ—¥æœŸå†…å®¹ä»‹ç´¹â€æ ‡ç­¾é¡µ
            activateTab('event-details', true);

            // è®¾ç½® categories-container çš„ active çŠ¶æ€
            activateCategoryTab(date);

            // è®¾ç½® events-container çš„ active çŠ¶æ€
            activateEventLink(date, masterId);
        } else if (system) {
            activateTab('system-overview', true); // åˆ‡æ¢åˆ° system-overview æ ‡ç­¾é¡µå¹¶æ»‘åŠ¨åˆ°å†…å®¹
            displaySystemDetails(system, true); // æ˜¾ç¤ºç³»ç»Ÿè¯¦ç»†ä¿¡æ¯
            activateSystemTab(system); // æ¿€æ´»ç³»ç»Ÿæ ‡ç­¾
        }
    });
	
	// å‹•æ…‹ç”Ÿæˆåˆ†é¡æ¨™ç±¤
	function generateCategoryTabs(events) {
		const categoriesContainer = document.getElementById('categories-container');
		categoriesContainer.innerHTML = ''; // ç¡®ä¿æ¸…ç©ºå½“å‰å†…å®¹

		// æ ¹æ“šæ¯å€‹äº‹ä»¶çš„æ—¥æœŸç”Ÿæˆå”¯ä¸€çš„åˆ†é¡æ¨™ç±¤
		events.forEach(event => {
			uniqueCategories.add(event.date); // æ·»åŠ åˆ°é›†åˆä¸­ç¢ºä¿å”¯ä¸€æ€§
		});

		// ç‚ºæ¯å€‹å”¯ä¸€çš„æ—¥æœŸå‰µå»ºä¸€å€‹æ¨™ç±¤
		uniqueCategories.forEach(date => {
			const tab = document.createElement('span');
			tab.classList.add('tab');
			tab.textContent = date;
			tab.setAttribute('data-category', date);
			tab.addEventListener('click', function() {
				displayEventsByDate(date);
				
				// è®¾ç½® active çŠ¶æ€ï¼Œå¹¶ç§»é™¤å…¶ä»– tab çš„ active çŠ¶æ€
				document.querySelectorAll('#categories-container .tab').forEach(t => t.classList.remove('active'));
				tab.classList.add('active');
				
				// è‡ªå‹•æ»¾å‹•åˆ°events-container
				<!-- const contentContainer = document.getElementById('events-container'); -->
				<!-- contentContainer.scrollIntoView({ behavior: 'smooth' }); -->
			});
			categoriesContainer.appendChild(tab);
		});
	}
	
	// æ¿€æ´» categories-container ä¸­å¯¹åº”çš„æ—¥æœŸæ ‡ç­¾
	function activateCategoryTab(date) {
		document.querySelectorAll('#categories-container .tab').forEach(t => {
			t.classList.remove('active');
			if (t.getAttribute('data-category') === date) {
				t.classList.add('active');
			}
		});
	}

	// æ ¹æ“šæ‰€é¸æ—¥æœŸå’Œ master ID é¡¯ç¤ºè©³ç´°ä¿¡æ¯ï¼ˆåœ–ç‰‡å’Œæ–‡å­—ï¼‰
	function displayDetailsByDate(date, masterId, shouldUpdateUrl = true) {
		const contentContainer = document.getElementById('content-container');
		const event = eventsData.find(e => e.date === date);

		if (event) {
			const master = event.masters.find(m => m.id === masterId);

			if (master) {
				// æ›´æ–°æ¨™é¡Œ
				document.getElementById('event-title').textContent = `${master.system}ï¼æ¡ƒåœ’TRPGæ¨å»£æœƒåœ˜å‹™ä»‹ç´¹`;

				// æ›´æ–°åœ–ç‰‡1 (Always show)
				const imageElement1 = document.getElementById('event-image');
				imageElement1.src = `image/${master.image1}`;

				// Check Image 2
				const imageElement2 = document.getElementById('event-image-2');
				if (master.image2) {
					imageElement2.src = `image/${master.image2}`;
					imageElement2.style.display = 'block';
				} else {
					imageElement2.style.display = 'none';
				}

				// æ›´æ–°å¼•è¨€ã€å…§æ–‡å’Œç°½å
				document.getElementById('event-quote').textContent = `â€œ${master.quote}â€`;
				document.getElementById('event-main-text').textContent = master.description;
				document.getElementById('event-signature').innerHTML = `æœ¬ä»‹ç´¹æ–‡ç”±ä¸»æŒäºº ${master.author} æ’°å¯«ã€‚<br>æœ¬æ–‡ç”¨æ–¼æ¡ƒåœ’TRPGæ¨å»£æœƒæ´»å‹•ä½¿ç”¨ã€‚`;

				// é¡¯ç¤ºå…§æ–‡å€å¡Š
				contentContainer.style.display = 'block';

				// æ»¾å‹•åˆ°å…§æ–‡å€å¡Š
				contentContainer.scrollIntoView({ behavior: 'smooth' });

				// æ›´æ–°ç¶²å€åˆ—
				if (shouldUpdateUrl) {
					const newUrl = `${window.location.pathname}?date=${date}&master=${masterId}`;
					if (newUrl !== window.location.href) {
						history.pushState({ date, master: masterId }, '', newUrl);
					}
				}
			} else {
				console.error('æœªçŸ¥çš„ Master IDï¼š', masterId);
				contentContainer.style.display = 'none';
			}
		} else {
			contentContainer.style.display = 'none';
		}
	}
	
	// æ ¹æ“šæ‰€é¸æ—¥æœŸé¡¯ç¤ºå°æ‡‰çš„æ´»å‹•
	function displayEventsByDate(date) {
		const eventsContainer = document.getElementById('events-container');
		eventsContainer.innerHTML = ''; // æ¸…ç©ºç•¶å‰çš„æ´»å‹•é¡¯ç¤º

		const event = eventsData.find(e => e.date === date);

		if (event && event.masters) {
			event.masters.forEach((master, index) => {
				const masterLink = document.createElement('a');
				masterLink.classList.add('event-link');
				masterLink.href = 'javascript:void(0)';
				masterLink.dataset.masterId = master.id; // Store master.id for activation
				masterLink.addEventListener('click', function() {
					displayDetailsByDate(event.date, master.id);
					activateEventLink(date, master.id);
				});

				const masterItem = document.createElement('div');
				masterItem.classList.add('event-item');
				masterItem.innerHTML = `<p><strong>ä¸»æŒäºº${index + 1}ï¼š</strong> ${master.name} (${master.system}, ${master.system_EN})</p>`;

				masterLink.appendChild(masterItem);
				eventsContainer.appendChild(masterLink);
			});
		} else {
			eventsContainer.innerHTML = `<p>æ­¤æ—¥æœŸä¸‹æ²’æœ‰æ´»å‹•ã€‚</p>`;
		}
	}
	
	// æ¿€æ´» events-container ä¸­å¯¹åº”çš„æ´»åŠ¨é“¾æ¥
	function activateEventLink(date, masterId) {
		document.querySelectorAll('.event-link').forEach(link => {
			link.classList.remove('active');
			if (link.dataset.masterId === masterId) {
				link.classList.add('active');
			}
		});
	}

	// è™•ç†ç€è¦½å™¨çš„å¾Œé€€/å‰é€²æŒ‰éˆ•ï¼Œæˆ–ç›´æ¥è¨ªå•ç‰¹å®šçš„ URL
	window.addEventListener('popstate', function(event) {
		if (event.state && event.state.date && event.state.master) {
			displayDetailsByDate(event.state.date, event.state.master, false);
		}
	});
	
	document.addEventListener('DOMContentLoaded', () => {
		
		const backToTopBtn = document.getElementById('backToTopBtn');
		// backToTopBtn
		window.addEventListener('scroll', () => {
			if (window.scrollY > 200) {
				backToTopBtn.style.display = 'block';
			} else {
				backToTopBtn.style.display = 'none';
			}
		});

		backToTopBtn.addEventListener('click', () => {
			window.scrollTo({ top: 0, behavior: 'smooth' });
		});
	});
	
	// æ˜¾ç¤ºæ‰€æœ‰ç³»ç»Ÿçš„è¯¦ç»†ä¿¡æ¯
	function displayAllSystems() {
		const singlesystemContentContainer = document.getElementById('system-content-container');
		const systemContentContainer = document.getElementById('dynamic-system-container');
		systemContentContainer.innerHTML = ''; // æ¸…ç©ºå½“å‰çš„ç³»ç»Ÿæ˜¾ç¤ºå†…å®¹

		systemData.forEach(system => {
			const systemDetailBlock = createSystemDetailBlock(system);
			systemContentContainer.appendChild(systemDetailBlock);
		});

		systemContentContainer.style.display = 'block'; // æ˜¾ç¤ºç³»ç»Ÿå†…æ–‡åŒºå—
		singlesystemContentContainer.style.display = 'none';
		
		// Clean URL buffer
		const baseUrl = window.location.pathname; // è·å–åŸºç¡€è·¯å¾„
		history.pushState({}, '', baseUrl); // æ›´æ–° URL åˆ°åŸºç¡€è·¯å¾„		
	}
	
	// åŠ¨æ€ç”Ÿæˆç³»ç»Ÿæ ‡ç­¾ï¼ŒTable
    function generateSystemTabs(systems) {
        const systemsContainer = document.getElementById('systems-container');
        systemsContainer.innerHTML = ''; // æ¸…ç©ºå½“å‰å†…å®¹
        
		
        // å‰µå»ºè¡¨æ ¼
		const table = document.createElement('table');
		table.style.width = "100%";
		table.style.borderCollapse = "collapse";

		// **ç¬¬ä¸€è¡Œ - ShowAll æŒ‰éˆ•**
		const showAllRow = document.createElement('tr');
		const showAllCell = document.createElement('td');
		showAllCell.textContent = "ShowAll";
		showAllCell.colSpan = 4; // âœ… **è·¨ 4 åˆ—**
		showAllCell.style.border = "1px solid #ddd";
		showAllCell.style.padding = "15px";
		showAllCell.style.textAlign = "center";
		showAllCell.style.cursor = "pointer";
		showAllCell.style.background = "#8DEEEE";
		showAllCell.style.fontWeight = "bold";
		showAllCell.style.fontSize = "18px";
		showAllCell.style.transition = "background 0.3s ease-in-out";

		// æ»‘é¼ æ‡¸åœæ•ˆæœ
		showAllCell.addEventListener("mouseover", () => {
			showAllCell.style.background = "#5F9EA0";
			showAllCell.style.color = "#fff";
		});
		showAllCell.addEventListener("mouseout", () => {
			showAllCell.style.background = "#8DEEEE";
			showAllCell.style.color = "#000";
		});

		// é»æ“Šäº‹ä»¶
		showAllCell.addEventListener('click', function () {
			displayAllSystems();
			document.querySelectorAll('#systems-container td').forEach(td => td.classList.remove('active'));
			showAllCell.classList.add('active');
		});

		showAllRow.appendChild(showAllCell);
		table.appendChild(showAllRow); // âœ… **å°‡ ShowAll ç½®æ–¼ç¬¬ä¸€è¡Œ**

		// **ç¬¬äºŒè¡Œé–‹å§‹ - ç³»çµ±å…§å®¹**
		let row;
		systems.forEach((system, index) => {
			// æ¯ 4 å€‹æ›ä¸€è¡Œ
			if (index % 4 === 0) {
				row = document.createElement('tr');
				table.appendChild(row);
			}

			// å‰µå»ºå–®å…ƒæ ¼
			const cell = document.createElement('td');
			cell.textContent = system.system + 'ã€Š' + system.system_EN + 'ã€‹';
			cell.setAttribute('data-system', system.system);
			cell.style.border = "1px solid #ddd";
			cell.style.padding = "10px";
			cell.style.textAlign = "center";
			cell.style.cursor = "pointer";
			cell.style.background = "#f9f9f9";
			cell.style.transition = "background 0.3s ease-in-out";

			// æ»‘é¼ æ‡¸åœæ•ˆæœ
			cell.addEventListener("mouseover", () => {
				cell.style.background = "#d0e9ff";
			});
			cell.addEventListener("mouseout", () => {
				if (!cell.classList.contains("active")) {
					cell.style.background = "#f9f9f9";
				}
			});

			// é»æ“Šäº‹ä»¶
			cell.addEventListener('click', function () {
				displaySystemDetails(system.system, true);
				document.querySelectorAll('#systems-container td').forEach(td => td.classList.remove('active'));
				cell.classList.add('active');
			});

			row.appendChild(cell);
		});

		systemsContainer.appendChild(table);

    }

    // æ ¹æ®ç³»ç»Ÿæ˜¾ç¤ºè¯¦ç»†ä¿¡æ¯
    document.addEventListener("DOMContentLoaded", function () {
		window.displaySystemDetails = function (systemName, shouldUpdateUrl = false) {
			const systemContentContainer = document.getElementById('system-content-container');
			const dynamicSystemContainer = document.getElementById('dynamic-system-container');
			dynamicSystemContainer.innerHTML = ''; // æ¸…ç©ºåŠ¨æ€å†…å®¹
			const filteredSystem = systemData.find(system => system.system === systemName);
			console.log("åŸ·è¡Œ displaySystemDetails:", systemName, shouldUpdateUrl);

			if (filteredSystem) {
				document.getElementById('system-title').textContent = `${filteredSystem.system} ã€Š${filteredSystem.system_EN}ã€‹- ç³»çµ±ä»‹ç´¹`;
				
				// æ›´æ–°å›¾ç‰‡1 (Always show)
				const imageElement1 = document.getElementById('system-image1');
				imageElement1.src = `image/${filteredSystem.image1}`; // æŒ‡å‘ image æ–‡ä»¶å¤¹ä¸­çš„å›¾ç‰‡1

				// æ›´æ–°å›¾ç‰‡2
				const imageElement2 = document.getElementById('system-image2');
				if (filteredSystem.image2) { 
					imageElement2.src = `image/${filteredSystem.image2}`; // æŒ‡å‘ image æ–‡ä»¶å¤¹ä¸­çš„å›¾ç‰‡2
					imageElement2.style.display = 'block'; // æ˜¾ç¤ºå›¾ç‰‡2
				} else {
					imageElement2.style.display = 'none'; // éšè—å›¾ç‰‡2
				}

				document.getElementById('system-quote').textContent = `â€œ${filteredSystem.Quote}â€`;
				document.getElementById('system-main-text').innerHTML = filteredSystem.Description;
				document.getElementById('system-signature').innerHTML = `æœ¬ä»‹ç´¹æ–‡ç”± ${filteredSystem.Author} æ’°å¯«ã€‚<br>æœ¬æ–‡ç”¨æ–¼æ¡ƒåœ’TRPGæ¨å»£æœƒæ´»å‹•ä½¿ç”¨ã€‚`;

				systemContentContainer.style.display = 'block'; // æ˜¾ç¤ºç³»ç»Ÿå†…æ–‡åŒºå—
				systemContentContainer.scrollIntoView({ behavior: 'smooth' });
				
				// æ›´æ–°ç½‘å€åˆ—
				if (shouldUpdateUrl) {
					const newUrl = `${window.location.pathname}?system=${encodeURIComponent(systemName)}`;
					if (newUrl !== window.location.href) {
						history.pushState({ system: systemName }, '', newUrl); // ä½¿ç”¨ history.pushState() æ›´æ–° URL
					}
				}
			} else {
				console.error("æ‰¾ä¸åˆ°ç³»çµ±è³‡æ–™:", systemName);
				systemContentContainer.style.display = 'none'; // å¦‚æœæ²¡æœ‰å¯¹åº”çš„è¯¦ç»†èµ„æ–™åˆ™éšè—ç³»ç»Ÿå†…æ–‡åŒºå—
			}
		};
	});	
	
	// åˆ›å»ºç³»ç»Ÿè¯¦ç»†ä¿¡æ¯å—
	function createSystemDetailBlock(system) {
		const block = document.createElement('div');
		block.classList.add('system-detail-block');

		const title = document.createElement('h2');
		title.textContent = `${system.system} ã€Š${system.system_EN}ã€‹- ç³»çµ±ä»‹ç´¹`;
		block.appendChild(title);

		// å›¾ç‰‡1
		const imageElement1 = document.createElement('img');
		imageElement1.src = `image/${system.image1}`;
		imageElement1.alt = 'image1';
		imageElement1.classList.add('system-image'); // ä¸ºå›¾ç‰‡æ·»åŠ ç±»
		block.appendChild(imageElement1);

		// å›¾ç‰‡2
		if (system.image2) {
			const imageElement2 = document.createElement('img');
			imageElement2.src = `image/${system.image2}`;
			imageElement2.alt = 'image2';
			imageElement2.classList.add('system-image'); // ä¸ºå›¾ç‰‡æ·»åŠ ç±»
			block.appendChild(imageElement2);
		}

		const quote = document.createElement('p');
		quote.classList.add('quote');
		quote.textContent = `â€œ${system.Quote}â€`;
		block.appendChild(quote);

		const description = document.createElement('p');
		description.classList.add('main-text');
		description.innerHTML = system.Description;
		block.appendChild(description);

		const signature = document.createElement('p');
		signature.classList.add('signature');
		signature.innerHTML = `æœ¬ä»‹ç´¹æ–‡ç”± ${system.Author} æ’°å¯«ã€‚<br>æœ¬æ–‡ç”¨æ–¼æ¡ƒåœ’TRPGæ¨å»£æœƒæ´»å‹•ä½¿ç”¨ã€‚`;
		block.appendChild(signature);

		return block;
	}
	
	function generateUTF8Text(length) {
		let randomText = "";
		
		for (let i = 0; i < length; i++) {
			const randomChar = String.fromCharCode(0x4E00 + Math.floor(Math.random() * 2000)); // ä¸­æ–‡å¸¸è¦‹ç¯„åœ
			randomText += randomChar;
		}
		
		return randomText;
	}

	
	document.addEventListener("DOMContentLoaded", function () {
		function isMobile() {
			return /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);
		}
		let currentMode = "image"; // é è¨­é¡¯ç¤ºæ–‡å­—
		let wordCloudElement = document.getElementById("word-cloud");

		
		function initializeWordCloud(mode) {
			// å–å¾— `#word-cloud` å®¹å™¨çš„çˆ¶ç‰©ä»¶
			let parentElement = document.getElementById("word-cloud").parentElement;
			let parentWidth = parentElement.clientWidth;
			console.log(parentWidth);

			// è¨­å®š `cloudSize` ç‚º `çˆ¶å®¹å™¨çš„ 80%`ï¼Œç¢ºä¿ä¸è¶…å‡ºç¯„åœ
			let cloudSize = Math.min(parentWidth * 0.8, 600); // é™åˆ¶æœ€å¤§ 800px

			fetch('system.json')
				.then(response => response.json())
				.then(data => {
					let systemData = data.details;
			
					// Mixed with parameter
					let entries = systemData.map(system => {
						var sys_len = Math.floor(Math.random() * 7) + 4;
						var sys_en_len = Math.floor(Math.random() * 7) + 4;
						if (mode === "text") {
							return { label: system.system + 'ã€Š' + system.system_EN + 'ã€‹', systemName: system.system };
						} else if (mode === "image") {
							return { image: './image/' + system.image1, width: 100, height: 100, systemName: system.system };
						} else if(mode === "chaos") {
							return { 
							label: generateUTF8Text(sys_len) + 'ã€Š' + generateUTF8Text(sys_en_len) + 'ã€‹', systemName: system.system };
						}
					});
					<!-- // ç”Ÿæˆ 3D æ–‡å­—é›²çš„è³‡æ–™æ ¼å¼ -->
					<!-- let entries = systemData.map(system => ({ -->
						<!-- label: system.system + 'ã€Š' + system.system_EN + 'ã€‹', -->
						<!-- systemName: system.system // å­˜å„²ç³»çµ±åç¨±ï¼Œä¹‹å¾Œç”¨æ–¼ click äº‹ä»¶ -->
					<!-- })); -->
					
					<!-- // ç”Ÿæˆ 3D æ–‡å­—é›²çš„è³‡æ–™æ ¼å¼(åœ–ç‰‡) -->
					<!-- let img_entries = systemData.map(system => ({ -->
						<!-- image: './image/' + system.image1 , -->
						<!-- width: 100, height: 100, -->
						<!-- systemName: system.system // å­˜å„²ç³»çµ±åç¨±ï¼Œä¹‹å¾Œç”¨æ–¼ click äº‹ä»¶ -->
					<!-- })); -->
					
					// **åˆ¤æ–·æ˜¯å¦ç‚ºæ‰‹æ©Ÿè£ç½®**
					let isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);

					// åˆå§‹åŒ– 3D æ–‡å­—é›²
					let settings = {
						entries: entries,
						width: parentWidth,   // ä¾æ“šçˆ¶å®¹å™¨å¤§å°è®ŠåŒ–
						height: isMobile? cloudSize+100 : cloudSize,
						radius: '100%',
						radiusMin: 75,
						bgDraw: false, // èƒŒæ™¯ç”± CSS æ§åˆ¶
						bgImage: "./image/word-cloud-bg.jpeg",
						opacityOver: 1.0,
						opacityOut: 0.05,
						opacitySpeed: 6,
						fov: 800,
						speed: isMobile ? 0.3 : 0.7, // âœ… æ‰‹æ©Ÿåœç”¨è‡ªå‹•æ—‹è½‰ï¼Œé›»è…¦ä¿æŒ 0.7
						fontFamily: "Arial, sans-serif",
						fontSize: isMobile ? 13 : 18,
						fontColor: "#fff",
						fontWeight: "bold",
						fontStyle: "normal",
						fontStretch: "normal",
						fontToUpperCase: false,
						onClick: function(systemName) {
							console.log("é»é¸ç³»çµ±:", systemName);
							let parsedSystemName = systemName.split("ã€Š")[0].trim(); // æ“·å– "ã€Š" ä¹‹å‰çš„æ–‡å­—
							console.log("è§£æå¾Œçš„ç³»çµ±åç¨±:", parsedSystemName);
							window.displaySystemDetails(parsedSystemName, true);
						}
					};

					let tagCloud = new SVG3DTagCloud(document.getElementById("word-cloud"), settings);
					// ğŸ“Œ **ä¿®æ­£ `textElements` çš„ä½œç”¨åŸŸ**
					let textElements = Array.from(document.querySelectorAll("#word-cloud text"));
					
				
				})
				.catch(error => console.error("è®€å– system.json éŒ¯èª¤:", error));
		}

		// **ç•¶é é¢è¼‰å…¥æ™‚ï¼Œåˆå§‹åŒ– 3D æ–‡å­—é›²**
		initializeWordCloud(currentMode);

		// **ç•¶è¦–çª—å¤§å°æ”¹è®Šæ™‚ï¼Œé‡æ–°èª¿æ•´ 3D æ–‡å­—é›²å¤§å°**
		window.addEventListener("resize", function () {
			document.getElementById("word-cloud").innerHTML = ""; // æ¸…é™¤èˆŠçš„ 3D æ–‡å­—é›²
			initializeWordCloud(currentMode);
		});
		
		// æ–‡å­—æŒ‰éˆ•é»æ“Šäº‹ä»¶
		document.getElementById("toggle-text").addEventListener("click", function () {
			if (currentMode !== "text") {
				currentMode = "text";
				document.getElementById("word-cloud").innerHTML = ""; // æ¸…é™¤èˆŠçš„ 3D æ–‡å­—é›²
				initializeWordCloud("text");
			}
		});

		// åœ–ç‰‡æŒ‰éˆ•é»æ“Šäº‹ä»¶
		document.getElementById("toggle-image").addEventListener("click", function () {
			if (currentMode !== "image") {
				currentMode = "image";
				document.getElementById("word-cloud").innerHTML = ""; // æ¸…é™¤èˆŠçš„ 3D æ–‡å­—é›²
				initializeWordCloud("image");
			}
		});
		
		// ChaosæŒ‰éˆ•é»æ“Šäº‹ä»¶
		document.getElementById("toggle-chaos").addEventListener("click", function () {
			if (currentMode !== "chaos") {
				currentMode = "chaos";
				document.getElementById("word-cloud").innerHTML = ""; // æ¸…é™¤èˆŠçš„ 3D æ–‡å­—é›²
				initializeWordCloud("chaos");
			}
		});

	});



</script>

</body>
</html>
