<script>
  // æª¢æŸ¥è¦–çª—å¯¬åº¦æ˜¯å¦å°æ–¼ 600ï¼Œå¦‚æœæ˜¯å°±å°å‘ index_mobile.html
  //console.log(screen.width);
  //if (screen.width < 600 && !location.pathname.includes("index_mobile.html")) {
  //  location.href = "index_mobile.html" + location.search;
  //}
</script>
<!DOCTYPE html>
<html lang="en">
<head>
	<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700&display=swap" rel="stylesheet">
	<script src="js/svg3DTagCloud.js"></script>
	<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
	<!-- Swiper CSS -->
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" />
	<!-- Swiper JS -->
	<script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="css/SystemStyle.css">
	<title>æ¡ƒåœ’TRPGæ¨å»£æœƒç³»çµ±ä»‹ç´¹</title>
</head>
<body>
	<div class="container">
		<!--æ¨™é¡Œå€åŸŸ-->
		<div class="header-container ">
			<div class="col-lg-12">
				<div class="row d-flex align-items-center">
					<div class="col-md-7 col-12 text-left p-3">
						<a href="https://sleepyknife.github.io/tyntrpg_system/" target="_blank" class="header-title">
                            <span >
                                æ¡Œä¸Šè§’è‰²æ‰®æ¼”éŠæˆ²ï¼ˆTRPG )<br>
                                ç³»çµ±å…¨é¢å°è¦½
                            </span>
						</a>
					</div>
					<div class="col-md-5 col-12 text-left p-3">
						<img src="image/dicecat_introduction.png" alt="éª°å­è²“ä¾†ä»‹ç´¹" class="img-fluid">
					</div>
				</div>
			</div>
		</div>
		<div class="tab-content active">
			<div class="col-lg-12 outer-container">
				<div class="col-lg-12 system-introduction">

					<div class="row d-flex align-items-center" style="padding-top: 2%; padding-bottom: 2%; padding-right: 5%; padding-left: 5%; ">
						<span   class="title-text" style="margin-bottom: 2%">
							ä»€éº¼æ˜¯TRPGç³»çµ±ï¼ŸåŸºæœ¬æ¦‚å¿µè§£æ<br />
						</span>
						<span  id="Description">
							TRPGç³»çµ±æ˜¯è¨­è¨ˆç”¨æ–¼æ¡Œä¸Šè§’è‰²æ‰®æ¼”éŠæˆ²çš„è¦å‰‡é›†ï¼Œå®ƒæä¾›äº†ä¸€å€‹çµæ§‹å’Œæ¡†æ¶ï¼Œè®“ç©å®¶å¯ä»¥æ‰®æ¼”è™›æ§‹çš„è§’è‰²ä¸¦åƒèˆ‡ä¸€å€‹å…±åŒçš„æ•…äº‹ã€‚TRPGç³»çµ±é€šå¸¸åŒ…å«è§’è‰²å‰µå»ºè¦å‰‡ã€æˆ°é¬¥ç³»çµ±ã€æŠ€èƒ½ç³»çµ±ã€é­”æ³•ç³»çµ±ä»¥åŠå…¶ä»–éŠæˆ²æ©Ÿåˆ¶ã€‚</br>
							ç°¡å–®ä¾†èªªï¼ŒTRPGç³»çµ±å°±æ˜¯ä¸€å€‹éŠæˆ²è¦å‰‡æ‰‹å†Šï¼Œå®ƒè®“ç©å®¶å¯ä»¥è‡ªç”±åœ°å‰µä½œæ•…äº‹ï¼Œä¸¦åœ¨ä¸€å€‹å……æ»¿æƒ³åƒåŠ›çš„ä¸–ç•Œä¸­æ¢ç´¢å’Œå†’éšªã€‚TRPGç³»çµ±é€šå¸¸ä½¿ç”¨éª°å­ä¾†è§£æ±ºéŠæˆ²ä¸­å„ç¨®äº‹ä»¶çš„çµæœï¼Œä¾‹å¦‚æˆ°é¬¥ã€æŠ€èƒ½æª¢å®šã€è§’è‰²çš„è¡Œå‹•ç­‰ã€‚
						</span>
					</div>
				</div>
			</div>
		</div>

		<!-- ç³»ç»Ÿä»‹ç» -->
		<div id="system-overview" class="tab-content active">
			<div class="system-section">
				<div class="col-lg-12">
					<div class="row d-flex align-items-center" style="padding-top: 2%; padding-bottom: 2%; padding-right: 5%; padding-left: 5%; text-align: center;">
						<span  class="title-text">ä¸»è¦TRPGç³»çµ±é¡å‹åŠç‰¹é»ä»‹ç´¹</span>
					</div>
				</div>
				<div id="category-container" style="margin: 1% 0; display: flex; justify-content: center; flex-wrap: wrap; "></div>

				<div id="SystemContent-container" class="accordding-container">
					<div class="col-lg-12 ">
						<div class="row d-flex align-items-center" style="padding-top: 4%; padding-bottom: 2%; padding-right: 5%; padding-left: 5%; text-align: left; ">
							<span class="fade-text" id="SystemStyle" style="margin-bottom : 2%">
								TRPGç³»çµ±ç™¾ç™¾ç¨®ï¼Œé¸å°å£å‘³æ‰ç©å¾—é–‹å¿ƒï¼<br />
							</span>
							<span class="fade-text" id="SystemStyle-Description" style="min-height:150px">
								ä½ æœ‰æƒ³éç•¶å€‹æŠ“é¬¼çš„ç¥æ£ã€æ‰“æ€ªçš„åŠå£«ã€é‚„æ˜¯é™°å½±ä¸­æ½›ä¼çš„ç¤¾ç•œé–“è«œå—ï¼ŸTRPGï¼ˆæ¡Œä¸Šè§’è‰²æ‰®æ¼”éŠæˆ²ï¼‰å°±åƒä¸€å ´å¤§å‹å³èˆˆæˆ²åŠ‡ï¼Œæ¯å¥—ç³»çµ±éƒ½æœ‰è‡ªå·±çš„ä¸–ç•Œè§€ã€ç©æ³•å’Œé¢¨æ ¼ã€‚æœ‰çš„èµ°é©šæ‚šè·¯ç·šï¼Œç†æ™ºå€¼æ‰æ»¿åœ°ï¼›æœ‰çš„å……æ»¿é­”æ³•èˆ‡é¨å£«ï¼Œæƒ³é£›å¤©å°±é£›å¤©ï¼›ä¹Ÿæœ‰é‚£ç¨®æ—¥å¸¸æç¬‘å‹çš„ï¼Œæ•´å ´åœ˜æ‰“å®Œå¤§å®¶åªè¨˜å¾—åæ§½å’Œäº‚å…¥ã€‚<br />
								TRPG çš„ç¾å¦™ä¹‹è™•å°±åœ¨æ–¼â€”â€”é¢¨æ ¼è¶…å¤šï¼Œè¦å‰‡å„ç•°ï¼Œä½ å¯ä»¥è‡ªç”±é¸æ“‡æœ€å°ä½ èƒƒå£çš„ç³»çµ±ï¼Œæ‰“é€ å±¬æ–¼ä½ çš„å°å®‡å®™ã€‚ä¸ç®¡ä½ æ˜¯åˆå…¥å‘çš„æ–°æ‰‹ï¼Œé‚„æ˜¯å·²ç¶“è·‘åœ˜åˆ°å¯ä»¥ç•¶ NPC çš„è€å±è‚¡ï¼Œåªè¦æ‰¾åˆ°åˆæ‹çš„ç³»çµ±ï¼Œå°±èƒ½é¦¬ä¸Šæ²‰æµ¸å…¶ä¸­ï¼Œå“­ã€ç¬‘ã€å°–å«ã€çˆ†è‚ï¼ˆï¼Ÿï¼‰éƒ½æœ‰äººé™ªä½ ä¸€èµ·é«”é©—ã€‚<br />
								ç¸½ä¹‹ï¼Œåˆ¥å®³ç¾ï¼ŒæŒ‘ä¸€ç¨®ä½ å–œæ­¡çš„é¢¨æ ¼ï¼Œä¾†å ´èªªç©å°±ç©çš„å†’éšªæ—…ç¨‹å§ï¼
							</span>
						</div>
					</div>
				</div>
				<div id="systems-container" class="system-tags">
				</div>
			</div>

			<div class="content-container" id="system-content-container" style="display: none;">
				<div class="row d-flex  align-items-start" style="padding: 2% 5%;">
					<!-- å³å´åœ–ç‰‡ -->
					<div class="col-lg-6 image-section" id="system-image-section">
						<div class="swiper mySwiper" id="system-swiper">
							<div class="swiper-wrapper" id="system-swiper-wrapper">
							</div>
							<div class="swiper-button-next"></div>
							<div class="swiper-button-prev"></div>
							<div class="swiper-pagination"></div>
						</div>
					</div>

					<!-- å·¦å´æ–‡å­— -->
					<div class="col-lg-6 text-section">
						<span id="system-title" style="margin-bottom: 20px; font-weight: bold;"></span>
						<p class="quote" id="system-quote">è¿™é‡Œæ˜¯å¼•è¨€éƒ¨åˆ†ã€‚</p><br />
						<p class="main-text" id="system-main-text">è¿™é‡Œæ˜¯å†…æ–‡çš„æ–‡å­—èŒƒä¾‹ã€‚</p>
						<p class="signature" id="system-signature">ç­¾åéƒ¨åˆ†</p>
					</div>
				</div>
			</div>

			<!-- åŠ¨æ€ç”Ÿæˆçš„ç³»ç»Ÿè¯¦ç»†ä¿¡æ¯å®¹å™¨ -->
			<div id="dynamic-system-container"></div>


		</div>
		<!--æ–‡å­—é›²-->
		<div class="Word-Cloud active">
			<div class="col-lg-12 outer-container">
				<div class="col-lg-12 ">

					<div class="row d-flex align-items-center justify-content-center text-center"
						 style="padding: 2% 5%;">
						<div class="col-lg-8">
							<span class="title-text" style=" margin-bottom: 1%;">
								å¿«é€Ÿæ¢ç´¢ç³»çµ±é¢¨æ ¼
							</span>
							<span style="font-size: 1.1rem;">
								ä¸çŸ¥å¾å“ªé–‹å§‹ï¼Ÿç”¨ä¸åŒè§’åº¦çœ‹çœ‹å„ç¨® TRPG ç³»çµ±çš„é­…åŠ›ï¼
							</span>
							<div id="explore-controls" class="explore-controls">
								<button id="btn-image-mode" class="explore-btn active">ğŸ–¼ï¸ åœ–ç‰‡æ¨¡å¼</button>
								<button id="btn-text-mode" class="explore-btn">ğŸ”¤ æ–‡å­—æ¨¡å¼</button>
								<button id="btn-random-pick" class="explore-btn">ğŸ² éš¨æ©Ÿæ¨è–¦</button>
							</div>
						</div>
					</div>
					<!-- Display Cloud Words -->
					<div id="word-cloud-container">
						<div id="word-cloud"></div>

					</div>
				</div>
			</div>
		</div>
		<!--äº‹ä»¶å€åŸŸ-->
		<div class="event-section">
			<!--<div class="col-lg-12 outer-container">-->
				<div class="col-lg-12 system-introduction">
					<div class="row d-flex align-items-center justify-content-center text-center" style="padding: 2% 5%;">
						<div class="col-lg-8">
							<span class="section-title">è¿‘æœŸ TRPG æ´»å‹•æ¨è–¦</span>
							<span class="section-description">
								é‚„ä¸çŸ¥é“è¦ç©å“ªå€‹ç³»çµ±å—ï¼Ÿä¹Ÿè¨±å¯ä»¥å¾æœ€è¿‘çš„æ¨å»£æ´»å‹•æ‰¾éˆæ„Ÿï¼Œçœ‹çœ‹ä¸»æŒäººæº–å‚™äº†å“ªäº›ç²¾å½©å†’éšªï¼
							</span>
						</div>
					</div>

					<div class="event-date-selector-wrapper" style="text-align: center; margin: 20px 0;">
						<select id="event-date-selector" class="event-date-selector">
							<option disabled selected>è«‹é¸æ“‡æ´»å‹•æ—¥æœŸ</option>
						</select>
					</div>
					<div class="events-container" id="events-container"></div>

				</div>
			<!--div-->
		</div>

	</div>
	<button id="backToTopBtn">å›åˆ°æœ€ä¸Šé¢</button>
	<script>
	// --- å…¨å±€è®Šé‡ ---
	let systemData = [];
	let eventsData = [];
	let SystemDescriptionData = {};

	// --- æ ¸å¿ƒï¼šçµ±ä¸€çš„é é¢åˆå§‹åŒ–å…¥å£ ---
	document.addEventListener("DOMContentLoaded", async () => {
		try {
			// 1. é¦–å…ˆï¼Œç­‰å¾…æ‰€æœ‰ JSON è³‡æ–™è¼‰å…¥å®Œæˆ
			await loadJsonFromFolder();

			// 2. è³‡æ–™è¼‰å…¥å¾Œï¼Œå†åˆå§‹åŒ–æ‰€æœ‰éœ€è¦è³‡æ–™çš„ UI å…ƒä»¶
			generateCategoryButtonsFromData(); // æ ¹æ“š systemData ç”¢ç”Ÿåˆ†é¡æŒ‰éˆ•
			generateCategorySelector(eventsData); // æ ¹æ“š eventsData ç”¢ç”Ÿæ—¥æœŸä¸‹æ‹‰é¸å–®
			initializeWordCloud("image"); // åˆå§‹åŒ–æ–‡å­—é›²

			// 3. è™•ç†ç•¶å‰ URL çš„åƒæ•¸ï¼Œæ±ºå®šè¦é¡¯ç¤ºå“ªå€‹ç³»çµ±/æ´»å‹•
			handleUrlParametersOnLoad();

			// 4. ç¶å®šä¸éœ€è¦ç­‰å¾…è³‡æ–™è¼‰å…¥çš„ UI äº‹ä»¶
			setupEventListeners();

		} catch (error) {
			console.error("é é¢åˆå§‹åŒ–å¤±æ•—:", error);
			// ä½ å¯ä»¥åœ¨æ­¤è™•å‘ç”¨æˆ¶é¡¯ç¤ºéŒ¯èª¤è¨Šæ¯
		}
	});

	// --- è³‡æ–™è¼‰å…¥ ---
	async function loadJsonFromFolder(folderPath = 'data/') {
		try {
			// åŠ ä¸Š timestamp é˜²æ­¢ manifest.json è¢«å¿«å–
			const manifestRes = await fetch(`${folderPath}manifest.json?t=${Date.now()}`);
			const manifest = await manifestRes.json();
			const jsonFiles = manifest.files;

			const fetches = jsonFiles.map(filename =>
				fetch(`${folderPath}${filename}?t=${Date.now()}`)
				.then(res => {
					if (!res.ok) throw new Error(`è®€å–å¤±æ•—ï¼š${filename} (${res.status})`);
					return res.json();
				})
			);

			const results = await Promise.all(fetches);
			
			// å°‡è®€å–åˆ°çš„è³‡æ–™å­˜å…¥å…¨å±€è®Šé‡
			systemData = results[0].details;
			eventsData = results[1].events;
			SystemDescriptionData = results[2].include;

		} catch (error) {
			console.error("è®€å– JSON è³‡æ–™æ™‚ç™¼ç”ŸéŒ¯èª¤ï¼š", error);
			throw error; // æ‹‹å‡ºéŒ¯èª¤ï¼Œè®“å¤–å±¤çš„ try...catch å¯ä»¥æ•ç²
		}
	}
	
	// --- é é¢å•Ÿå‹•é‚è¼¯ ---
	function handleUrlParametersOnLoad() {
		const params = new URLSearchParams(window.location.search);
		const date = params.get('date');
		let system = params.get('system');
		const master = params.get('master');

		if (date && master) {
			// æ¡ˆä¾‹ 1: URL åŒ…å«æ—¥æœŸå’Œä¸»æŒäºº ID (é€™æ˜¯æœ€é«˜å„ªå…ˆç´š)
			// æˆ‘å€‘å¾ eventsData ä¸­åæŸ¥ç³»çµ±åç¨±
			if (!system) {
				const event = eventsData.find(e => e.date === date);
				if (event?.masters) {
					const masterInfo = event.masters.find(m => m.id === master);
					if (masterInfo) {
						system = masterInfo.system; // æˆåŠŸæ‰¾åˆ°ç³»çµ±åç¨±
					}
				}
			}
			renderEventCards(date); // æ¸²æŸ“è©²æ—¥æœŸçš„æ‰€æœ‰æ´»å‹•å¡ç‰‡
			if (system) {
				displaySystemDetails(system, master, date, true); // é¡¯ç¤ºè©³ç´°è³‡è¨Š
			} else {
				console.warn(`åœ¨ ${date} çš„æ´»å‹•ä¸­æ‰¾ä¸åˆ°ä¸»æŒäºº ${master} çš„ç³»çµ±è³‡è¨Šã€‚`);
			}

		} else if (system) {
			// æ¡ˆä¾‹ 2: URL åªåŒ…å«ç³»çµ±åç¨±
			displaySystemDetails(system, null, null, true);
		}
	}

	// --- äº‹ä»¶ç¶å®š ---
	function setupEventListeners() {
		// å›åˆ°é ‚éƒ¨æŒ‰éˆ•
		const btn = document.getElementById('backToTopBtn');
		window.addEventListener('scroll', () => {
			btn.style.display = window.scrollY > 200 ? 'block' : 'none';
		});
		btn.addEventListener('click', () => window.scrollTo({ top: 0, behavior: 'smooth' }));

		// ç€è¦½å™¨ä¸Šä¸€é /ä¸‹ä¸€é äº‹ä»¶
		window.addEventListener('popstate', e => {
			if (e.state?.system) {
				// ä¿®æ­£äº†åƒæ•¸é †åºéŒ¯èª¤çš„å•é¡Œ
				displaySystemDetails(
					e.state.system,
					e.state.master || null,
					e.state.date || null,
					false
				);
			}
		});

		// æ–‡å­—é›²æ¨¡å¼åˆ‡æ›æŒ‰éˆ•
		const modeButtons = {
			"btn-image-mode": "image",
			"btn-text-mode": "text",
			"btn-random-pick": "random"
		};
		Object.entries(modeButtons).forEach(([btnId, mode]) => {
			const btn = document.getElementById(btnId);
			if (btn) {
				btn.addEventListener("click", () => reloadCloud(mode));
			}
		});
		
		// æ—¥æœŸé¸æ“‡å™¨äº‹ä»¶
		const dateSelector = document.getElementById('event-date-selector');
		dateSelector.addEventListener('change', function () {
			const selectedDate = this.value;
			renderEventCards(selectedDate);
			const eventBlock = document.getElementById('events-container');
			if (eventBlock) {
				eventBlock.scrollIntoView({ behavior: 'smooth' });
			}
		});
	}

	// --- UI ç”Ÿæˆèˆ‡æ›´æ–° (ä»¥ä¸‹æ˜¯ä½ çš„åŸå§‹å‡½å¼ï¼Œç¨ä½œèª¿æ•´) ---

	function generateCategoryButtonsFromData() {
        const categories = [...new Set(
            systemData.flatMap(system =>
                system.category.split('ã€').map(tag => tag.trim())
            )
        )].sort((a, b) => a.length - b.length);
        categories.unshift("å…¨éƒ¨");
        generateCategoryButtons(categories); // å‘¼å«ä½ åŸæœ‰çš„å‡½å¼
    }

	function generateCategoryButtons(categories) {
		const categoryContainer = document.getElementById("category-container");
		categoryContainer.innerHTML = '';
		categories.forEach(category => {
			const button = document.createElement("button");
			button.textContent = category;
			button.className = "category-button";
			button.addEventListener("click", () => {
				ShowSystemStyleDescription(category);
			});
			categoryContainer.appendChild(button);
		});
	}

	function generateCategorySelector(events) {
		const selector = document.getElementById('event-date-selector');
		selector.innerHTML = '<option disabled selected>è«‹é¸æ“‡æ´»å‹•æ—¥æœŸ</option>';
		const uniqueDates = [...new Set(events.map(e => e.date))];
		uniqueDates.forEach(date => {
			const option = document.createElement('option');
			option.value = date;
			option.textContent = date;
			selector.appendChild(option);
		});
	}
	
	function initializeWordCloud(mode) {
		const wordCloudElement = document.getElementById("word-cloud");
		const parent = wordCloudElement.parentElement;
		const parentWidth = parent.clientWidth;
		const cloudSize = Math.min(parentWidth * 0.8, 600);
		const isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);

		// ç›´æ¥ä½¿ç”¨å·²è¼‰å…¥çš„ systemDataï¼Œä¸å†é‡è¤‡ fetch
		if (mode === "random") {
			const randomSystem = systemData[Math.floor(Math.random() * systemData.length)];
			displaySystemDetails(randomSystem.system, null, null, true);
			return;
		}

		const entries = systemData.map(system => {
			if (mode === "text") {
				return { label: `${system.system}ã€Š${system.system_EN}ã€‹`, systemName: system.system };
			} else if (mode === "image") {
				return {
					image: './image/' + system.image1,
					width: isMobile ? 80 : 140,
					height: isMobile ? 80 : 140,
					systemName: system.system
				};
			}
		});

		const settings = {
			entries,
			width: parentWidth,
			height: isMobile ? cloudSize + 100 : cloudSize,
			radius: '100%',
			radiusMin: 75,
			bgDraw: false,
			opacityOver: 1.0,
			opacityOut: 0.05,
			opacitySpeed: 6,
			fov: 800,
			speed: isMobile ? 0.2 : 0.3,
			fontFamily: "Arial, sans-serif",
			fontSize: isMobile ? 13 : 18,
			fontColor: "#fff",
			fontWeight: "bold",
			onClick(systemName) {
				const parsed = systemName.split("ã€Š")[0].trim();
				displaySystemDetails(parsed, null, null, true);
			}
		};
		
		new SVG3DTagCloud(wordCloudElement, settings);
	}

	// å…±ç”¨åˆ·æ–°æ–‡å­—é›²æ–¹æ³•
	let currentCloudMode = "image";
	function reloadCloud(mode) {
		currentCloudMode = mode;
		const wordCloudElement = document.getElementById("word-cloud");
		wordCloudElement.innerHTML = "";
		initializeWordCloud(mode);
	}
	// ç›£è½è¦–çª—å¤§å°è®ŠåŒ–ä»¥é‡ç¹ªæ–‡å­—é›²
	window.addEventListener("resize", () => reloadCloud(currentCloudMode));


	// --- å…¶ä»–æ‰€æœ‰ä½ çš„å‡½å¼ç¶­æŒä¸è®Š ---
	// (ä¾‹å¦‚: displaySystemDetails, renderEventCards, ShowSystemStyleDescription, etc.)
	// ... å°‡ä½ å…¶ä»–çš„å‡½å¼è²¼åœ¨é€™è£¡ ...
	// function renderEventCards(TargetData) { ... }
	// function ShowSystemStyleDescription(SystemStyle) { ... }
	// ... etc ...
	// ä½ çš„æ‰€æœ‰å‡½å¼ï¼Œä¾‹å¦‚ displaySystemDetails, clean, generateSystemTabs ç­‰ç­‰ï¼Œéƒ½å¯ä»¥åŸå°ä¸å‹•åœ°è¤‡è£½åˆ°é€™è£¡ã€‚
	// ä»¥ä¸‹è²¼ä¸Šä½ åŸæœ‰çš„å‡½å¼ï¼Œç¢ºä¿å®ƒå€‘éƒ½èƒ½è¢«å‘¼å«åˆ°

	function renderEventCards(TargetData) {
		const container = document.getElementById('events-container');
		container.innerHTML = ''; // æ¸…ç©º
		const event = eventsData.find(e => e.date === TargetData);
		if (!event || !event.masters) {
			container.innerHTML = '<p>æ­¤æ—¥æœŸä¸‹æ²’æœ‰æ´»å‹•ã€‚</p>';
			return;
		}
		event.masters.forEach(master => {
			const card = document.createElement('a');
			card.className = 'event-card';
			card.innerHTML = `
				<span>ä¸»æŒäººï¼š${master.name}</span> <br>
				<span>ç³»çµ±ï¼š${master.system}ï¼ˆ${master.system_EN}ï¼‰</span>
			`;
			card.addEventListener('click', () => {
				displaySystemDetails(master.system, master.id, event.date, true);
				document.querySelectorAll('.event-card').forEach(c => c.classList.remove('active'));
				card.classList.add('active');
			});
			container.appendChild(card);
		});
	}

	function ShowSystemStyleDescription(SystemStyle) {
		const match = SystemDescriptionData.find(data => data.name === SystemStyle);
		if (match) {
			const titleEl = document.getElementById("SystemStyle");
			const descEl = document.getElementById("SystemStyle-Description");
			let displayName = match.name;
			if (displayName === "å…¨éƒ¨") { displayName = "å°å­©å­æ‰åšé¸æ“‡ï¼æˆ‘å…¨éƒ½è¦ï¼"; }
			fadeTextChange(titleEl, displayName);
			fadeTextChange(descEl, match.description);
		}
		displaySystemsByCategory(SystemStyle);
		const sysContainer = document.getElementById("systems-container");
		if (sysContainer && !sysContainer.classList.contains("active")) {
			sysContainer.style.display = "block";
			setTimeout(() => {
				sysContainer.classList.add("active");
			}, 400);
		}
		const SysContenter = document.getElementById("system-content-container");
		if (SysContenter) {
			SysContenter.classList.add("hide");
			setTimeout(() => {
				SysContenter.style.display = "none";
			}, 500);
		}
	}

	function displaySystemsByCategory(category) {
		const filtered = (category === "å…¨éƒ¨")
			? systemData
			: systemData.filter(system => system.category.includes(category));
		generateSystemTabs(filtered);
	}

	function generateSystemTabs(systems) {
		const systemsContainer = document.getElementById('systems-container');
		systemsContainer.innerHTML = '';
		const table = document.createElement('table');
		table.className = 'system-table';
		const showAllRow = document.createElement('tr');
		const showAllCell = document.createElement('td');
		showAllCell.className = 'system-title-cell';
		showAllCell.colSpan = 2;
		showAllCell.textContent = 'ç³»çµ±ä¸€è¦½';
		showAllRow.appendChild(showAllCell);
		table.appendChild(showAllRow);
		let row;
		systems.forEach((system, index) => {
			if (index % 2 === 0) {
				row = document.createElement('tr');
				table.appendChild(row);
			}
			const cell = document.createElement('td');
			cell.className = 'system-cell ' + (Math.floor(index / 2) % 2 === 0 ? 'system-row-even' : 'system-row-odd');
			cell.setAttribute('data-system', system.system);
			const textSpan = document.createElement('span');
			textSpan.className = 'system-fade';
			textSpan.textContent = `${system.system}ã€Š${system.system_EN}ã€‹`;
			cell.appendChild(textSpan);
			setTimeout(() => textSpan.style.opacity = '1', 20 * index);
			cell.addEventListener('click', () => {
				document.querySelectorAll('#systems-container td').forEach(td => {
					td.classList.remove('active');
					td.classList.remove('system-row-even', 'system-row-odd');
					const r = Math.floor([...td.parentNode.parentNode.children].indexOf(td.parentNode) - 1);
					if (r >= 0) {
						td.classList.add(r % 2 === 0 ? 'system-row-even' : 'system-row-odd');
					}
				});
				cell.classList.add('active');
				const container = document.getElementById('system-content-container');
				container.style.display = 'block';
				container.classList.remove('hide');
				displaySystemDetails(system.system, null, system.update, true);
			});
			row.appendChild(cell);
		});
		systemsContainer.appendChild(table);
	}

	function clean(str) {
		return str
			?.toString()
			.replace(/[\u200B-\u200D\uFEFF]/g, '')
			.replace(/\s/g, '')
			.trim();
	}

	function displaySystemDetails(systemName, masterId, eventDate, shouldUpdateUrl = false) {
		const systemContentContainer = document.getElementById('system-content-container');
		let displayData = null;
		let masterInfo = null;
		let system_EN = null;
		if (eventDate && masterId) {
			const event = eventsData.find(e => e.date === eventDate);
			if (event && event.masters) {
				masterInfo = event.masters.find(m => m.id === masterId);
				if (masterInfo) {
					system_EN = masterInfo.system_EN;
				}
			}
		}
		if (systemName && !system_EN) {
			const system = systemData.find(s => clean(s.system).includes(clean(systemName)));
			if (system) {
				system_EN = system.system_EN;
			}
		}
		if (system_EN) {
			const system = systemData.find(s => clean(s.system_EN) === clean(system_EN));
			if (system) {
				displayData = {
					system: system.system,
					system_EN: system.system_EN,
					quote: system.Quote,
					description: system.Description,
					author: system.Author,
					image1: system.image1,
					image2: system.image2
				};
			}
		}
		if (masterInfo) {
			if (!displayData) { displayData = {}; }
			displayData.system = masterInfo.system || displayData.system;
			displayData.system_EN = masterInfo.system_EN || displayData.system_EN;
			displayData.quote = masterInfo.quote || displayData.quote;
			displayData.description = masterInfo.description || displayData.description;
			displayData.author = masterInfo.name;
			displayData.image1 = masterInfo.image1 || displayData.image1;
			displayData.image2 = masterInfo.image2 || displayData.image2;
		}
		if (!displayData) {
			console.error("æ‰¾ä¸åˆ°ç³»çµ±è³‡æ–™:", { systemName, system_EN, masterId, eventDate });
			systemContentContainer.style.display = 'none';
			return;
		}
		document.getElementById('system-title').innerHTML = ` ${displayData.system} <br>ã€Š${displayData.system_EN}ã€‹`;
		document.getElementById('system-quote').textContent = displayData.quote ? `â€œ${displayData.quote}â€` : "";
		document.getElementById('system-main-text').innerHTML = displayData.description || "";
		document.getElementById('system-signature').innerHTML = `æœ¬ä»‹ç´¹æ–‡ç”± ${displayData.author} æ’°å¯«ã€‚<br>æœ¬æ–‡ç”¨æ–¼æ¡ƒåœ’TRPGæ¨å»£æœƒæ´»å‹•ä½¿ç”¨ã€‚`;
		const swiperWrapper = document.getElementById('system-swiper-wrapper');
		swiperWrapper.innerHTML = '';
		[displayData.image1, displayData.image2].forEach((imagePath, index) => {
			if (imagePath) {
				const slide = document.createElement('div');
				slide.className = 'swiper-slide';
				const img = document.createElement('img');
				img.src = `image/${imagePath}`;
				img.alt = `image${index + 1}`;
				slide.appendChild(img);
				swiperWrapper.appendChild(slide);
			}
		});
		if (window.systemSwiper) {
			window.systemSwiper.destroy(true, true);
		}
		window.systemSwiper = new Swiper(".mySwiper", {
			loop: true,
			navigation: { nextEl: ".swiper-button-next", prevEl: ".swiper-button-prev" },
			pagination: { el: ".swiper-pagination", clickable: true },
			autoplay: { delay: 5000, disableOnInteraction: false }
		});
		systemContentContainer.style.display = 'block';
		systemContentContainer.scrollIntoView({ behavior: 'smooth' });
		if (shouldUpdateUrl) {
			const stateData = {
				system: displayData.system,
				date: eventDate || null,
				master: masterId || null
			};
			const params = new URLSearchParams();
			params.set('system', stateData.system);
			if (stateData.date) params.set('date', stateData.date);
			if (stateData.master) params.set('master', stateData.master);
			const newUrl = `${window.location.pathname}?${params.toString()}`;
			if (newUrl !== window.location.href) {
				history.pushState(stateData, '', newUrl);
			}
		}
	}
	
	function fadeTextChange(element, newText) {
		if (!element) return;
		element.classList.add('fade-out');
		setTimeout(() => {
			element.innerHTML = newText;
			element.classList.remove('fade-out');
		}, 300);
	}
</script>

</body>
</html>
