<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
	<script src="svg3DTagCloud.js"></script>
    <title>æ¡ƒåœ’TRPGæ¨å»£æœƒç³»çµ±ä»‹ç´¹</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f5f5f5;
        }

        .container {
            width: 80%;
            margin: 20px auto; /* èª¿æ•´å®¹å™¨çš„é ‚éƒ¨é–“è·å’Œæ°´å¹³å±…ä¸­ */
        }

        .header-container, .date-container, .content-container {
            width: 100%;
            padding: 20px;
            text-align: center;
            background-color: #97FFFF;
            border: 1px solid #ddd;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }

        .content-container {
            display: flex; /* ä½¿å…§å®¹éƒ¨åˆ†ç‚ºå½ˆæ€§ä½ˆå±€ */
            flex-direction: column; /* åˆå§‹ç‚ºç¸±å‘ä½ˆå±€ */
            align-items: center; /* ä½¿å…§éƒ¨å…§å®¹å±…ä¸­ */
			max-width: 96%; /* ç¡®ä¿çˆ¶å®¹å™¨çš„å®½åº¦ä¸è¶…è¿‡é¡µé¢ */

        }

        .image-section {
            display: flex; /* ä½¿ç”¨ Flexbox ä½¿åœ–ç‰‡ä¸¦æ’ */
            justify-content: space-between; /* ç¢ºä¿åœ–ç‰‡ä¹‹é–“çš„é–“è· */
            width: 100%; /* ç¢ºä¿åœ–ç‰‡å€å¡Šä½”æ»¿çˆ¶å®¹å™¨å¯¬åº¦ */
            gap: 10px; /* è¨­ç½®åœ–ç‰‡ä¹‹é–“çš„é–“éš” */
            margin-bottom: 15px;
        }

        .image-section img {
            max-width: 50%; /* åœ–ç‰‡æœ€å¤§å¯¬åº¦ç‚ºçˆ¶å®¹å™¨çš„ä¸€åŠ */
            width: 100%; /* ç¢ºä¿åœ–ç‰‡å¯¬åº¦å……æ»¿å®¹å™¨ */
            flex: 1; /* è®“åœ–ç‰‡å„è‡ªå ä¸€åŠå¯¬åº¦ */
            border-radius: 10px;
        }

        .text-section {
            display: flex;
            flex-direction: column;
            justify-content: center;
            text-align: left; /* æ–‡å­—éƒ¨åˆ†å·¦å°é½Š */
            width: 100%; /* ç¢ºä¿æ–‡å­—å€å¡Šä½”æ»¿çˆ¶å®¹å™¨å¯¬åº¦ */
        }

        .quote {
            font-style: italic;
            font-size: 1.2em;
            color: #555;
            margin-bottom: 10px;
            white-space: pre-line;
        }

        .main-text {
            font-size: 1em;
            line-height: 1.6;
            color: #333;
            margin-bottom: 15px;
            white-space: pre-line;
        }

        .signature {
            font-family: 'Courier New', Courier, monospace;
            font-size: 0.9em;
            color: #888;
            text-align: right;
            margin-top: 20px;
            white-space: pre-line;
        }

        .tab-container {
            margin-bottom: 20px;
            text-align: center;
        }

        .tab {
            cursor: pointer;
            padding: 10px;
            margin: 5px;
            background-color: #8DEEEE;
            border-radius: 5px;
            display: inline-block;
        }

        .tab.active {
            background-color: #5F9EA0;
            font-weight: bold;
        }

        .tab-content {
            display: none; /* é»˜è®¤éšè—å†…å®¹ */
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background-color: #f9f9f9;
			max-width: 96%; /* ç¡®ä¿çˆ¶å®¹å™¨çš„å®½åº¦ä¸è¶…è¿‡é¡µé¢ */

        }

        .tab-content.active {
            display: block; /* æ¿€æ´»çŠ¶æ€æ˜¾ç¤ºå†…å®¹ */
        }
		
        .event-item {
            margin: 10px 0;
            padding: 10px;
            background-color: #79CDCD;
            border-radius: 5px;
        }

        .events-container, .systems-container {
            margin-top: 20px;
        }

        a.event-link, a.system-link {
            text-decoration: none; /* ç§»é™¤é»˜èªçš„è¶…é€£çµä¸‹åŠƒç·š */
            color: inherit; /* ä½¿ç”¨é»˜èªæ–‡å­—é¡è‰² */
            display: block; /* è®“æ•´å€‹å€å¡Šå¯é»æ“Š */
        }
		
		a.event-link:hover {
			background-color: #B0E0E6; /* æ‚¬åœæ—¶çš„èƒŒæ™¯é¢œè‰² */
		}

		a.event-link.active {
			background-color: #5F9EA0; /* æ¿€æ´»çŠ¶æ€çš„èƒŒæ™¯é¢œè‰² */
			color: #fff; /* æ¿€æ´»çŠ¶æ€çš„æ–‡æœ¬é¢œè‰² */
			font-weight: bold; /* æ¿€æ´»çŠ¶æ€çš„æ–‡æœ¬åŠ ç²— */
		}
		
		#backToTopBtn {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background-color: rgba(0, 0, 0, 0.5);
            color: white;
            border: none;
            padding: 10px 20px;
            cursor: pointer;
            border-radius: 5px;
            display: none; /* Initially hidden */
        }
		
		.system-image{
            max-width: 50%; /* åœ–ç‰‡æœ€å¤§å¯¬åº¦ç‚ºçˆ¶å®¹å™¨çš„ä¸€åŠ */
            width: 100%; /* ç¢ºä¿åœ–ç‰‡å¯¬åº¦å……æ»¿å®¹å™¨ */
            flex: 1; /* è®“åœ–ç‰‡å„è‡ªå ä¸€åŠå¯¬åº¦ */
            border-radius: 10px;
        }
		
		/* è®“ 3D æ–‡å­—é›²çš„å®¹å™¨ `#word-cloud` æ ¹æ“šçˆ¶ç‰©ä»¶å¤§å°è®ŠåŒ– */
		#word-cloud {
			width: 100%; /* è®“å¯¬åº¦è·Ÿéš¨çˆ¶å®¹å™¨ */
			height: 100%; /* è®“é«˜åº¦æ ¹æ“šå…§å®¹è®ŠåŒ– */
			max-height: 600px;
			background: #111; /* æ·±è‰²èƒŒæ™¯ï¼Œè®“ 3D æ–‡å­—é›²æ›´æ˜é¡¯ */
			overflow: hidden;
		}

		/* è®“ `svg` å…§å®¹ä¹Ÿè‡ªé©æ‡‰ */
		#word-cloud svg {
			width: 100%;
			height: 100%;
			display: block;
		}
    </style>
</head>
<body>

<div class="container">
	<a href="https://sleepyknife.github.io/tyntrpg_system/" target="_blank">
		<!-- æ¨™é¡Œå€å¡Š -->
		<div class="header-container">
			<h1>æ¡ƒåœ’TRPGæ¨å»£æœƒç³»çµ±ä»‹ç´¹</h1>
		</div>
	</a>

    <!-- æ ‡ç­¾é¡µå®¹å™¨ -->
    <div class="tab-container">
        <span class="tab active" data-tab="system-overview">ç³»ç»Ÿä»‹ç»ç¸½è¡¨</span>
        <span class="tab" data-tab="event-details">æ´»å‹•æ—¥æœŸä»‹ç»</span>
    </div>

    <!-- ç³»ç»Ÿä»‹ç»æ€»è¡¨å†…å®¹ -->
    <div id="system-overview" class="tab-content active">
        <h2>ç³»ç»Ÿä»‹ç»ç¸½è¡¨</h2>
        <!-- ç³»ç»Ÿä»‹ç»æ€»è¡¨çš„å†…å®¹å¯ä»¥æ”¾åœ¨è¿™é‡Œ -->
        <p>é€™è£¡é¡¯ç¤ºç³»ç»Ÿä»‹ç»çš„ç¸½è¡¨å†…å®¹ã€‚æŒçºŒæ•´ç†ä¸­ã€‚(à¹‘â€¢Ì â‚ƒ â€¢Ì€à¹‘)</p>
		<p>é»é¸ç³»çµ±æœƒè‡ªå‹•è·³åˆ°è©²ç³»çµ±ä»‹ç´¹ï¼Œä¸‹é¢ShowAllå‰‡æœƒé¡¯ç¤ºå…¨éƒ¨å…§å®¹~</p>
		
		<!-- Display Cloud Words -->
		<div id="word-cloud"></div>
		
		<!-- åŠ¨æ€ç”Ÿæˆçš„ç³»ç»Ÿæ ‡ç­¾åŒº -->
        <div id="systems-container">
            <!-- è¿™é‡Œå°†é€šè¿‡ JavaScript åŠ¨æ€ç”Ÿæˆç³»ç»Ÿæ ‡ç­¾ -->
        </div>
		
		<!-- å†…æ–‡åŒºå—ï¼Œåˆ†ä¸ºå›¾ç‰‡å’Œæ–‡å­— -->
        <div class="content-container" id="system-content-container" style="display: none;">
            <!-- æ–°å¢çš„æ ‡é¢˜åŒºå— -->
            <h2 id="system-title" style="text-align: center; margin-bottom: 25px;"></h2>
            
            <!-- å›¾ç‰‡åŒºå— -->
            <div class="image-section" id="system-image-section">
                <img src="" alt="ç¤ºä¾‹å›¾ç‰‡" id="system-image1">
                <img src="" alt="ç¤ºä¾‹å›¾ç‰‡2" id="system-image2">
            </div>

            <!-- æ–‡å­—åŒºå— -->
            <div class="text-section">
                <p class="quote" id="system-quote">è¿™é‡Œæ˜¯å¼•è¨€éƒ¨åˆ†ã€‚</p>
                <p class="main-text" id="system-main-text">è¿™é‡Œæ˜¯å†…æ–‡çš„æ–‡å­—èŒƒä¾‹ã€‚</p>
                <p class="signature" id="system-signature">ç­¾åéƒ¨åˆ†</p>
            </div>
        </div>
		
		<!-- åŠ¨æ€ç”Ÿæˆçš„ç³»ç»Ÿè¯¦ç»†ä¿¡æ¯å®¹å™¨ -->
		<div id="dynamic-system-container"></div>
    </div>

    <!-- æ´»åŠ¨æ—¥æœŸå†…å®¹ä»‹ç» -->
    <div id="event-details" class="tab-content">
        <h2>æ´»å‹•æ—¥æœŸä»‹ç´¹</h2>
        <!-- åŠ¨æ€ç”Ÿæˆçš„åˆ†ç±»æ ‡ç­¾åŒº -->
        <div id="categories-container">
            <!-- è¿™é‡Œå°†é€šè¿‡ JavaScript åŠ¨æ€ç”Ÿæˆåˆ†ç±»æ ‡ç­¾ -->
        </div>

        <!-- æ´»åŠ¨æ˜¾ç¤ºåŒº -->
        <div class="events-container" id="events-container">
            <!-- æ ¹æ®ç‚¹å‡»çš„æ ‡ç­¾æ¥æ˜¾ç¤ºç›¸åº”çš„æ´»åŠ¨ -->
        </div>

        <!-- å…§æ–‡å€å¡Šï¼Œåˆ†ç‚ºåœ–ç‰‡å’Œæ–‡å­— -->
        <div class="content-container" id="content-container" style="display: none;">

            <!-- æ–°å¢çš„æ¨™é¡Œå€å¡Š -->
            <h2 id="event-title" style="text-align: center; margin-bottom: 25px;"></h2>

            <!-- åœ–ç‰‡å€å¡Š -->
            <div class="image-section" id="image-section">
                <img src="" alt="ç¤ºä¾‹åœ–ç‰‡" id="event-image">
                <img src="" alt="ç¤ºä¾‹åœ–ç‰‡2" id="event-image-2">
            </div>

            <!-- æ–‡å­—å€å¡Š -->
            <div class="text-section">
                <!-- å¼•è¨€éƒ¨åˆ† -->
                <p class="quote" id="event-quote">é€™è£¡æ˜¯å¼•è¨€éƒ¨åˆ†ã€‚</p>
                <!-- å…§æ–‡éƒ¨åˆ† -->
                <p class="main-text" id="event-main-text">é€™è£¡æ˜¯å…§æ–‡çš„æ–‡å­—ç¯„ä¾‹ã€‚</p>
                <!-- ç°½åéƒ¨åˆ† -->
                <p class="signature" id="event-signature">ç°½åéƒ¨åˆ†</p>
            </div>
        </div>
    </div>	
</div>
	<button id="backToTopBtn">å›åˆ°æœ€ä¸Šé¢</button>

<script>
    // æ ‡ç­¾é¡µåˆ‡æ¢é€»è¾‘
    const tabs = document.querySelectorAll('.tab');
    const tabContents = document.querySelectorAll('.tab-content');

    tabs.forEach(tab => {
        tab.addEventListener('click', function () {
            // ç§»é™¤æ‰€æœ‰æ ‡ç­¾çš„æ¿€æ´»çŠ¶æ€
            tabs.forEach(t => t.classList.remove('active'));
            // éšè—æ‰€æœ‰æ ‡ç­¾é¡µå†…å®¹
            tabContents.forEach(tc => tc.classList.remove('active'));

            // æ¿€æ´»å½“å‰æ ‡ç­¾å¹¶æ˜¾ç¤ºå¯¹åº”å†…å®¹
            tab.classList.add('active');
            const contentId = tab.getAttribute('data-tab');
            document.getElementById(contentId).classList.add('active');
        });
    });
	
	function activateTab(tabName, shouldScrollToContent = false) {
		// ç§»é™¤æ‰€æœ‰æ ‡ç­¾çš„æ¿€æ´»çŠ¶æ€
		tabs.forEach(t => t.classList.remove('active'));
		// éšè—æ‰€æœ‰æ ‡ç­¾é¡µå†…å®¹
		tabContents.forEach(tc => tc.classList.remove('active'));

		// æ¿€æ´»æŒ‡å®šæ ‡ç­¾å¹¶æ˜¾ç¤ºå¯¹åº”å†…å®¹
		const targetTab = Array.from(tabs).find(tab => tab.getAttribute('data-tab') === tabName);
		const targetContent = document.getElementById(tabName);

		if (targetTab && targetContent) {
			targetTab.classList.add('active');
			targetContent.classList.add('active');
			
			// å¦‚æœéœ€è¦æ»šåŠ¨åˆ° content-container
			if (shouldScrollToContent && tabName === 'event-details') {
				const contentContainer = document.getElementById('content-container');
				contentContainer.scrollIntoView({ behavior: 'smooth' });
			} else if (shouldScrollToContent && tabName === 'system-overview') {
                const systemContentContainer = document.getElementById('system-content-container');
                systemContentContainer.scrollIntoView({ behavior: 'smooth' });
            }
		}
	}

	// æ·»åŠ æ ‡ç­¾é¡µç‚¹å‡»äº‹ä»¶
	tabs.forEach(tab => {
		tab.addEventListener('click', function () {
			const contentId = tab.getAttribute('data-tab');
			activateTab(contentId);
		});
	});

    // å…¨å±€è®Šé‡ä¾†å­˜å„²è®€å–çš„äº‹ä»¶è³‡æ–™
	let systemData = [];
    let eventsData = [];
    let uniqueCategories = new Set();
    let detailData = {};
	let systenData = {};
	const paramsOnLoad = new URLSearchParams(window.location.search);
	
	// è¯»å– system.json æ–‡ä»¶å¹¶å­˜å‚¨ç³»ç»Ÿèµ„æ–™
    const fetchSystemData = fetch('system.json')
        .then(response => response.json())
        .then(data => {
            systemData = data.details;
            generateSystemTabs(systemData);
			displayAllSystems(); // é»˜è®¤æ˜¾ç¤ºæ‰€æœ‰ç³»ç»Ÿè¯¦ç»†ä¿¡æ¯
        })
        .catch(error => {
            console.error('è¯»å–ç³»ç»Ÿèµ„æ–™æ—¶å‡ºé”™:', error);
        });

    // è®€å– JSON æ–‡ä»¶ä¸¦å­˜å„²äº‹ä»¶è³‡æ–™
    const fetchEventsData = fetch('event_date.json')
        .then(response => response.json())
        .then(data => {
            eventsData = data.events;
            generateCategoryTabs(eventsData);
        })
        .catch(error => {
            console.error('è®€å–äº‹ä»¶è³‡æ–™æ™‚å‡ºéŒ¯:', error);
        });

    // è®€å– detail.json æ–‡ä»¶ä¸¦å­˜å„²è©³ç´°è³‡æ–™
    const fetchDetailData = fetch('detail.json')
        .then(response => response.json())
        .then(data => {
            detailData = data.details;
        })
        .catch(error => {
            console.error('è®€å–è©³ç´°è³‡æ–™æ™‚å‡ºéŒ¯:', error);
        });
		
	

    // ç­‰å¾…æ‰€æœ‰æ•¸æ“šè®€å–å®Œæˆå¾ŒåŸ·è¡Œåˆå§‹åŒ–
    Promise.all([fetchSystemData, fetchEventsData, fetchDetailData]).then(() => {
        // è®€å–å®Œå¾Œï¼Œæª¢æŸ¥åƒæ•¸
        const date = paramsOnLoad.get('date');
        const master = paramsOnLoad.get('master');
		const system = paramsOnLoad.get('system');
		
        if (date && master) {
            document.getElementById('content-container').style.display = 'block';
			displayEventsByDate(date); // æ˜¾ç¤ºè¯¥æ—¥æœŸä¸‹çš„äº‹ä»¶
            displayDetailsByDate(date, master); // è‡ªåŠ¨æ˜¾ç¤ºè¯¦ç»†ä¿¡æ¯
			
			// è‡ªåŠ¨åˆ‡æ¢åˆ°â€œæ´»åŠ¨æ—¥æœŸå†…å®¹ä»‹ç»â€æ ‡ç­¾é¡µ
			activateTab('event-details',true);
			
			// è®¾ç½® categories-container çš„ active çŠ¶æ€
			activateCategoryTab(date);
			
			// è®¾ç½® events-container çš„ active çŠ¶æ€
			activateEventLink(date, master);
        }
		else if(system)
		{
			activateTab('system-overview', true); // åˆ‡æ¢åˆ° system-overview æ ‡ç­¾é¡µå¹¶æ»‘åŠ¨åˆ°å†…å®¹
			displaySystemDetails(system, true); // æ˜¾ç¤ºç³»ç»Ÿè¯¦ç»†ä¿¡æ¯
			activateSystemTab(system); // æ¿€æ´»ç³»ç»Ÿæ ‡ç­¾
		}
    });
	
	// å‹•æ…‹ç”Ÿæˆåˆ†é¡æ¨™ç±¤
	function generateCategoryTabs(events) {
		const categoriesContainer = document.getElementById('categories-container');
		categoriesContainer.innerHTML = ''; // ç¡®ä¿æ¸…ç©ºå½“å‰å†…å®¹

		// æ ¹æ“šæ¯å€‹äº‹ä»¶çš„æ—¥æœŸç”Ÿæˆå”¯ä¸€çš„åˆ†é¡æ¨™ç±¤
		events.forEach(event => {
			uniqueCategories.add(event.date); // æ·»åŠ åˆ°é›†åˆä¸­ç¢ºä¿å”¯ä¸€æ€§
		});

		// ç‚ºæ¯å€‹å”¯ä¸€çš„æ—¥æœŸå‰µå»ºä¸€å€‹æ¨™ç±¤
		uniqueCategories.forEach(date => {
			const tab = document.createElement('span');
			tab.classList.add('tab');
			tab.textContent = date;
			tab.setAttribute('data-category', date);
			tab.addEventListener('click', function() {
				displayEventsByDate(date);
				
				// è®¾ç½® active çŠ¶æ€ï¼Œå¹¶ç§»é™¤å…¶ä»– tab çš„ active çŠ¶æ€
				document.querySelectorAll('#categories-container .tab').forEach(t => t.classList.remove('active'));
				tab.classList.add('active');
				
				// è‡ªå‹•æ»¾å‹•åˆ°events-container
				<!-- const contentContainer = document.getElementById('events-container'); -->
				<!-- contentContainer.scrollIntoView({ behavior: 'smooth' }); -->
			});
			categoriesContainer.appendChild(tab);
		});
	}
	
	// æ¿€æ´» categories-container ä¸­å¯¹åº”çš„æ—¥æœŸæ ‡ç­¾
	function activateCategoryTab(date) {
		document.querySelectorAll('#categories-container .tab').forEach(t => {
			t.classList.remove('active');
			if (t.getAttribute('data-category') === date) {
				t.classList.add('active');
			}
		});
	}

	// æ ¹æ“šæ‰€é¸æ—¥æœŸå’Œ master é¡¯ç¤ºè©³ç´°ä¿¡æ¯ï¼ˆåœ–ç‰‡å’Œæ–‡å­—ï¼‰
	function displayDetailsByDate(date, master, shouldUpdateUrl = true) {
		const contentContainer = document.getElementById('content-container');
		const filteredDetail = detailData.find(detail => detail.date === date);
	
		if (filteredDetail) {
			let masterName, masterImage1, masterImage2, masterSystem, masterDescription,authorDescription;

			// æ ¹æ“šé¸æ“‡çš„ master è¨­ç½®ç›¸æ‡‰çš„è©³ç´°ä¿¡æ¯
			if (master === 'master1') {
				masterName = filteredDetail.master1_name;
				masterImage1 = filteredDetail.master1_image1;
				masterImage2 = filteredDetail.master1_image2;
				masterSystem = filteredDetail.master1_system;
				masterQuote = filteredDetail.master1_quote;
				masterDescription = filteredDetail.master1_description;
				authorDescription = filteredDetail.system1_author;
			} else if (master === 'master2') {
				masterName = filteredDetail.master2_name;
				masterImage1 = filteredDetail.master2_image1;
				masterImage2 = filteredDetail.master2_image2;
				masterSystem = filteredDetail.master2_system;
				masterQuote = filteredDetail.master2_quote;
				masterDescription = filteredDetail.master2_description;
				authorDescription = filteredDetail.system2_author;
			} else if (master === 'master3') {
				masterName = filteredDetail.master3_name;
				masterImage1 = filteredDetail.master3_image1;
				masterImage2 = filteredDetail.master3_image2;
				masterSystem = filteredDetail.master3_system;
				masterQuote = filteredDetail.master3_quote;
				masterDescription = filteredDetail.master3_description;
				authorDescription = filteredDetail.system3_author;
			} else {
				console.error('æœªçŸ¥çš„ Masterï¼š', master);
				return;
			}
			
			// æ›´æ–°æ¨™é¡Œ
			document.getElementById('event-title').textContent = `${masterSystem}ï¼æ¡ƒåœ’TRPGæ¨å»£æœƒåœ˜å‹™ä»‹ç´¹`;
			
			// æ›´æ–°åœ–ç‰‡1 (Always show)
			const imageElement1 = document.getElementById('event-image');
			imageElement1.src = `image/${masterImage1}`; // æŒ‡å‘ image æ–‡ä»¶å¤¾ä¸­çš„åœ–ç‰‡1

			// Check Image 2
			const imageElement2 = document.getElementById('event-image-2');
			if (masterImage2) { // å¦‚æœåœ–ç‰‡2çš„è·¯å¾„å­˜åœ¨ä¸”ä¸ä¸ºç©º
				imageElement2.src = `image/${masterImage2}`; // æŒ‡å‘ image æ–‡ä»¶å¤¹ä¸­çš„åœ–ç‰‡2
				imageElement2.style.display = 'block'; // æ˜¾ç¤ºåœ–ç‰‡2
			} else {
				imageElement2.style.display = 'none'; // éšè—åœ–ç‰‡2
			}

			// æ›´æ–°å¼•è¨€ã€å…§æ–‡å’Œç°½å
			document.getElementById('event-quote').textContent = `â€œ${masterQuote}â€`;
			document.getElementById('event-main-text').textContent = masterDescription;
			document.getElementById('event-signature').innerHTML = `æœ¬ä»‹ç´¹æ–‡ç”±ä¸»æŒäºº ${authorDescription} æ’°å¯«ã€‚<br>æœ¬æ–‡ç”¨æ–¼æ¡ƒåœ’TRPGæ¨å»£æœƒæ´»å‹•ä½¿ç”¨ã€‚`;

			// é¡¯ç¤ºå…§æ–‡å€å¡Š
			contentContainer.style.display = 'block';
			
			// æ»¾å‹•åˆ°å…§æ–‡å€å¡Š
			contentContainer.scrollIntoView({ behavior: 'smooth' });
			
			// æ›´æ–°ç¶²å€åˆ—
			if (shouldUpdateUrl) {
				const newUrl = `${window.location.pathname}?date=${date}&master=${master}`;
				if (newUrl !== window.location.href) {  // ç¢ºä¿ URL ä¸é‡è¤‡
					history.pushState({ date, master }, '', newUrl); // ä½¿ç”¨ history.pushState() æ›´æ–° URL
				}
			}
		} else {
			contentContainer.style.display = 'none'; // å¦‚æœæ²’æœ‰å°æ‡‰çš„è©³ç´°è³‡æ–™å‰‡éš±è—å…§æ–‡å€å¡Š
		}
	}
	
	// æ ¹æ“šæ‰€é¸æ—¥æœŸé¡¯ç¤ºå°æ‡‰çš„æ´»å‹•
	function displayEventsByDate(date) {
		const eventsContainer = document.getElementById('events-container');
		eventsContainer.innerHTML = ''; // æ¸…ç©ºç•¶å‰çš„æ´»å‹•é¡¯ç¤º

		const filteredEvents = eventsData.filter(event => event.date === date);

		// å°‡ç¯©é¸å‡ºçš„æ´»å‹•æ·»åŠ åˆ°å®¹å™¨ä¸­
		if (filteredEvents.length > 0) {
			filteredEvents.forEach(event => {
				// Master1 è¶…é€£çµ
				const master1Link = document.createElement('a');
				master1Link.classList.add('event-link');
				master1Link.href = 'javascript:void(0)'; // è¨­ç½®è·³è½‰åˆ°å…§æ–‡å€å¡Šçš„è¶…é€£çµ
				master1Link.addEventListener('click', function() {
					displayDetailsByDate(event.date, 'master1'); // é»æ“Šæ™‚é¡¯ç¤º Master1 è©³ç´°å…§å®¹
					
					// é…ç½® active çŠ¶æ€ï¼Œç§»é™¤å…¶ä»–é“¾æ¥çš„ active çŠ¶æ€
					activateEventLink(date, 'master1');
				});

				const master1Item = document.createElement('div');
				master1Item.classList.add('event-item');
				master1Item.innerHTML = `<p><strong>ä¸»æŒäºº1ï¼š</strong> ${event.master1} (${event.system1}, ${event.system1_EN})</p>`;
				
				master1Link.appendChild(master1Item);
				eventsContainer.appendChild(master1Link);

				// Master2 è¶…é€£çµ
				const master2Link = document.createElement('a');
				master2Link.classList.add('event-link');
				master2Link.href = 'javascript:void(0)';
				master2Link.addEventListener('click', function() {
					displayDetailsByDate(event.date, 'master2'); // é»æ“Šæ™‚é¡¯ç¤º Master2 è©³ç´°å…§å®¹
					
					// é…ç½® active çŠ¶æ€ï¼Œç§»é™¤å…¶ä»–é“¾æ¥çš„ active çŠ¶æ€
					activateEventLink(date, 'master2');
				});

				const master2Item = document.createElement('div');
				master2Item.classList.add('event-item');
				master2Item.innerHTML = `
					<p><strong>ä¸»æŒäºº2ï¼š</strong> ${event.master2} (${event.system2}, ${event.system2_EN})</p>
				`;
				
				master2Link.appendChild(master2Item);
				eventsContainer.appendChild(master2Link);

				// Master3 è¶…é€£çµ
				const master3Link = document.createElement('a');
				master3Link.classList.add('event-link');
				master3Link.href = 'javascript:void(0)';
				master3Link.addEventListener('click', function() {
					displayDetailsByDate(event.date, 'master3'); // é»æ“Šæ™‚é¡¯ç¤º Master3 è©³ç´°å…§å®¹
					
					// é…ç½® active çŠ¶æ€ï¼Œç§»é™¤å…¶ä»–é“¾æ¥çš„ active çŠ¶æ€
					activateEventLink(date, 'master3');
				});

				const master3Item = document.createElement('div');
				master3Item.classList.add('event-item');
				master3Item.innerHTML = `
					<p><strong>ä¸»æŒäºº3ï¼š</strong> ${event.master3} (${event.system3}, ${event.system3_EN})</p>
				`;
				
				master3Link.appendChild(master3Item);
				eventsContainer.appendChild(master3Link);
			});
		} else {
			eventsContainer.innerHTML = `<p>æ­¤æ—¥æœŸä¸‹æ²’æœ‰æ´»å‹•ã€‚</p>`;
		}
	}
	
	// æ¿€æ´» events-container ä¸­å¯¹åº”çš„æ´»åŠ¨é“¾æ¥
	function activateEventLink(date, master) {
		const masterNumber = master.replace('master', ''); // æå– master çš„æ•°å­—éƒ¨åˆ†
		document.querySelectorAll('.event-link').forEach((link, index) => {
			link.classList.remove('active');
			// æ ¹æ® master çš„æ•°å­—æ¥æ¿€æ´»å¯¹åº”çš„é“¾æ¥
			if (index === parseInt(masterNumber) - 1) {
				link.classList.add('active');
			}
		});
	}
	
	// è™•ç†ç€è¦½å™¨çš„å¾Œé€€/å‰é€²æŒ‰éˆ•ï¼Œæˆ–ç›´æ¥è¨ªå•ç‰¹å®šçš„ URL
	window.addEventListener('popstate', function(event) {
		if (event.state) {
			displayDetailsByDate(event.state.date, event.state.master, false);
		}
	});
	
	document.addEventListener('DOMContentLoaded', () => {
		
		const backToTopBtn = document.getElementById('backToTopBtn');
		// backToTopBtn
		window.addEventListener('scroll', () => {
			if (window.scrollY > 200) {
				backToTopBtn.style.display = 'block';
			} else {
				backToTopBtn.style.display = 'none';
			}
		});

		backToTopBtn.addEventListener('click', () => {
			window.scrollTo({ top: 0, behavior: 'smooth' });
		});
	});
	
	// æ˜¾ç¤ºæ‰€æœ‰ç³»ç»Ÿçš„è¯¦ç»†ä¿¡æ¯
	function displayAllSystems() {
		const singlesystemContentContainer = document.getElementById('system-content-container');
		const systemContentContainer = document.getElementById('dynamic-system-container');
		systemContentContainer.innerHTML = ''; // æ¸…ç©ºå½“å‰çš„ç³»ç»Ÿæ˜¾ç¤ºå†…å®¹

		systemData.forEach(system => {
			const systemDetailBlock = createSystemDetailBlock(system);
			systemContentContainer.appendChild(systemDetailBlock);
		});

		systemContentContainer.style.display = 'block'; // æ˜¾ç¤ºç³»ç»Ÿå†…æ–‡åŒºå—
		singlesystemContentContainer.style.display = 'none';
		
		// Clean URL buffer
		const baseUrl = window.location.pathname; // è·å–åŸºç¡€è·¯å¾„
		history.pushState({}, '', baseUrl); // æ›´æ–° URL åˆ°åŸºç¡€è·¯å¾„		
	}
	
	// åŠ¨æ€ç”Ÿæˆç³»ç»Ÿæ ‡ç­¾
    function generateSystemTabs(systems) {
        const systemsContainer = document.getElementById('systems-container');
        systemsContainer.innerHTML = ''; // æ¸…ç©ºå½“å‰å†…å®¹
        
		/*
        systems.forEach(system => {
            const tab = document.createElement('span');
            tab.classList.add('tab'); // ä½¿ç”¨ä¸ä¸» tab ç›¸åŒçš„ç±»ï¼Œä»¥å…±äº«æ ·å¼å’Œè¡Œä¸º
            tab.textContent = system.system+'ã€Š'+system.system_EN+'ã€‹';
            tab.setAttribute('data-system', system.system);
            tab.addEventListener('click', function() {
                // æ˜¾ç¤ºç³»ç»Ÿè¯¦ç»†ä¿¡æ¯
                displaySystemDetails(system.system, true);
                // è®¾ç½® active çŠ¶æ€
                document.querySelectorAll('#systems-container .tab').forEach(t => t.classList.remove('active'));
                tab.classList.add('active');
            });
            systemsContainer.appendChild(tab);
        });*/
		
		const all_tab = document.createElement('span');
		all_tab.classList.add('tab'); // ä½¿ç”¨ä¸ä¸» tab ç›¸åŒçš„ç±»ï¼Œä»¥å…±äº«æ ·å¼å’Œè¡Œä¸º
		all_tab.textContent = "ShowAll";
		all_tab.classList.add('active');
		all_tab.addEventListener('click', function() {
			displayAllSystems();
			// è®¾ç½® active çŠ¶æ€
			document.querySelectorAll('#systems-container .tab').forEach(t => t.classList.remove('active'));
			all_tab.classList.add('active');
		});
		systemsContainer.appendChild(all_tab);

    }

    // æ ¹æ®ç³»ç»Ÿæ˜¾ç¤ºè¯¦ç»†ä¿¡æ¯
    document.addEventListener("DOMContentLoaded", function () {
		window.displaySystemDetails = function (systemName, shouldUpdateUrl = false) {
			const systemContentContainer = document.getElementById('system-content-container');
			const dynamicSystemContainer = document.getElementById('dynamic-system-container');
			dynamicSystemContainer.innerHTML = ''; // æ¸…ç©ºåŠ¨æ€å†…å®¹
			const filteredSystem = systemData.find(system => system.system === systemName);

			if (filteredSystem) {
				document.getElementById('system-title').textContent = `${filteredSystem.system} ã€Š${filteredSystem.system_EN}ã€‹- ç³»ç»Ÿä»‹ç»`;
				
				// æ›´æ–°å›¾ç‰‡1 (Always show)
				const imageElement1 = document.getElementById('system-image1');
				imageElement1.src = `image/${filteredSystem.image1}`; // æŒ‡å‘ image æ–‡ä»¶å¤¹ä¸­çš„å›¾ç‰‡1

				// æ›´æ–°å›¾ç‰‡2
				const imageElement2 = document.getElementById('system-image2');
				if (filteredSystem.image2) { 
					imageElement2.src = `image/${filteredSystem.image2}`; // æŒ‡å‘ image æ–‡ä»¶å¤¹ä¸­çš„å›¾ç‰‡2
					imageElement2.style.display = 'block'; // æ˜¾ç¤ºå›¾ç‰‡2
				} else {
					imageElement2.style.display = 'none'; // éšè—å›¾ç‰‡2
				}

				document.getElementById('system-quote').textContent = `â€œ${filteredSystem.Quote}â€`;
				document.getElementById('system-main-text').innerHTML = filteredSystem.Description;
				document.getElementById('system-signature').innerHTML = `æœ¬ä»‹ç»æ–‡ç”± ${filteredSystem.Author} æ’°å¯«ã€‚<br>æœ¬æ–‡ç”¨æ–¼æ¡ƒåœ’TRPGæ¨å»£æœƒæ´»å‹•ä½¿ç”¨ã€‚`;

				systemContentContainer.style.display = 'block'; // æ˜¾ç¤ºç³»ç»Ÿå†…æ–‡åŒºå—
				systemContentContainer.scrollIntoView({ behavior: 'smooth' });
				
				// æ›´æ–°ç½‘å€åˆ—
				if (shouldUpdateUrl) {
					const newUrl = `${window.location.pathname}?system=${encodeURIComponent(systemName)}`;
					if (newUrl !== window.location.href) {
						history.pushState({ system: systemName }, '', newUrl); // ä½¿ç”¨ history.pushState() æ›´æ–° URL
					}
				}
			} else {
				systemContentContainer.style.display = 'none'; // å¦‚æœæ²¡æœ‰å¯¹åº”çš„è¯¦ç»†èµ„æ–™åˆ™éšè—ç³»ç»Ÿå†…æ–‡åŒºå—
			}
		};
	});	
	
	// åˆ›å»ºç³»ç»Ÿè¯¦ç»†ä¿¡æ¯å—
	function createSystemDetailBlock(system) {
		const block = document.createElement('div');
		block.classList.add('system-detail-block');

		const title = document.createElement('h2');
		title.textContent = `${system.system} ã€Š${system.system_EN}ã€‹- ç³»ç»Ÿä»‹ç»`;
		block.appendChild(title);

		// å›¾ç‰‡1
		const imageElement1 = document.createElement('img');
		imageElement1.src = `image/${system.image1}`;
		imageElement1.alt = 'image1';
		imageElement1.classList.add('system-image'); // ä¸ºå›¾ç‰‡æ·»åŠ ç±»
		block.appendChild(imageElement1);

		// å›¾ç‰‡2
		if (system.image2) {
			const imageElement2 = document.createElement('img');
			imageElement2.src = `image/${system.image2}`;
			imageElement2.alt = 'image2';
			imageElement2.classList.add('system-image'); // ä¸ºå›¾ç‰‡æ·»åŠ ç±»
			block.appendChild(imageElement2);
		}

		const quote = document.createElement('p');
		quote.classList.add('quote');
		quote.textContent = `â€œ${system.Quote}â€`;
		block.appendChild(quote);

		const description = document.createElement('p');
		description.classList.add('main-text');
		description.innerHTML = system.Description;
		block.appendChild(description);

		const signature = document.createElement('p');
		signature.classList.add('signature');
		signature.innerHTML = `æœ¬ä»‹ç»æ–‡ç”± ${system.Author} æ’°å¯«ã€‚<br>æœ¬æ–‡ç”¨æ–¼æ¡ƒåœ’TRPGæ¨å»£æœƒæ´»å‹•ä½¿ç”¨ã€‚`;
		block.appendChild(signature);

		return block;
	}
	
	document.addEventListener("DOMContentLoaded", function () {
		function isMobile() {
			return /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);
		}

		
		function initializeWordCloud() {
			// å–å¾— `#word-cloud` å®¹å™¨çš„çˆ¶ç‰©ä»¶
			let parentElement = document.getElementById("word-cloud").parentElement;
			let parentWidth = parentElement.clientWidth;
			console.log(parentWidth);

			// è¨­å®š `cloudSize` ç‚º `çˆ¶å®¹å™¨çš„ 80%`ï¼Œç¢ºä¿ä¸è¶…å‡ºç¯„åœ
			let cloudSize = Math.min(parentWidth * 0.8, 600); // é™åˆ¶æœ€å¤§ 800px

			fetch('system.json')
				.then(response => response.json())
				.then(data => {
					let systemData = data.details;

					// ç”Ÿæˆ 3D æ–‡å­—é›²çš„è³‡æ–™æ ¼å¼
					let entries = systemData.map(system => ({
						label: system.system + 'ã€Š' + system.system_EN + 'ã€‹',
						systemName: system.system // å­˜å„²ç³»çµ±åç¨±ï¼Œä¹‹å¾Œç”¨æ–¼ click äº‹ä»¶
					}));
					
					// **åˆ¤æ–·æ˜¯å¦ç‚ºæ‰‹æ©Ÿè£ç½®**
					let isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);

					// åˆå§‹åŒ– 3D æ–‡å­—é›²
					let settings = {
						entries: entries,
						width: parentWidth,   // ä¾æ“šçˆ¶å®¹å™¨å¤§å°è®ŠåŒ–
						height: isMobile? cloudSize+100 : cloudSize,
						radius: '100%',
						radiusMin: 75,
						bgDraw: false, // èƒŒæ™¯ç”± CSS æ§åˆ¶
						opacityOver: 1.0,
						opacityOut: 0.05,
						opacitySpeed: 6,
						fov: 800,
						speed: isMobile ? 0.3 : 0.7, // âœ… æ‰‹æ©Ÿåœç”¨è‡ªå‹•æ—‹è½‰ï¼Œé›»è…¦ä¿æŒ 0.7
						fontFamily: "Arial, sans-serif",
						fontSize: isMobile ? 13 : 18,
						fontColor: "#fff",
						fontWeight: "bold",
						fontStyle: "normal",
						fontStretch: "normal",
						fontToUpperCase: false,
						onClick: function(systemName) {
							console.log("é»é¸ç³»çµ±:", systemName);
							displaySystemDetails(systemName, true);
						}
					};

					let tagCloud = new SVG3DTagCloud(document.getElementById("word-cloud"), settings);
					// ğŸ“Œ **ä¿®æ­£ `textElements` çš„ä½œç”¨åŸŸ**
					let textElements = Array.from(document.querySelectorAll("#word-cloud text"));
					
					// ç¶å®š `click` äº‹ä»¶åˆ° 3D æ–‡å­—é›²å…§çš„ `<text>` æ¨™ç±¤
					if(1)
					{
						
						let textElements = document.querySelectorAll("#word-cloud text");
						textElements.forEach((element, index) => {
							element.style.cursor = "pointer"; // è®“æ»‘é¼ è®Šæˆå¯é»æ“Šæ¨£å¼
							element.addEventListener("click", function (event) {
								event.preventDefault(); // é˜²æ­¢é–‹æ–°åˆ†é 
								let selectedSystem = entries[index].systemName;
								console.log("é¸æ“‡çš„ç³»çµ±: ", selectedSystem);
								displaySystemDetails(selectedSystem, true); // å‘¼å«ä½ çš„é»æ“Šäº‹ä»¶
							});
						});
					}
					
					// ğŸ“Œ **æ‰‹æ©Ÿï¼šé»æ“Šèˆ‡æ»‘å‹•å€åˆ†**
					// if (isMobile) {
						// let wordCloud = document.getElementById("word-cloud");
						// let touchStartX = 0, touchStartY = 0, touchEndX = 0, touchEndY = 0;
						// let isDragging = false;

						// wordCloud.addEventListener("touchstart", function (event) {
							// let touch = event.touches[0];
							// touchStartX = touch.clientX;
							// touchStartY = touch.clientY;
							// isDragging = false;
							// console.log(tagCloud.speed);
							// tagCloud.speed = 0;
							
							// event.preventDefault(); // é˜»æ­¢é é¢æ»¾å‹•
						// }, { passive: false });

						// wordCloud.addEventListener("touchmove", function (event) {
							// isDragging = true;
							// let touch = event.touches[0];
							// touchEndX = touch.clientX;
							// touchEndY = touch.clientY;
						// });

						// wordCloud.addEventListener("touchend", function (event) {
							// let dx = Math.abs(touchEndX - touchStartX);
							// let dy = Math.abs(touchEndY - touchStartY);
							// let moveThreshold = 5; // ğŸ“Œ **è¨­å®šæ»‘å‹•é–¾å€¼**

							// if (dx < moveThreshold && dy < moveThreshold) {
								// // ğŸ“Œ **æ‰‹æŒ‡ç§»å‹•å¾ˆå°ï¼Œè§¸ç™¼é»æ“Š**
								// let touchedElement = document.elementFromPoint(touchEndX, touchEndY);
								// if (touchedElement && touchedElement.tagName === "text") {
									// let index = Array.from(textElements).indexOf(touchedElement);
									// if (index !== -1) {
										// let selectedSystem = entries[index].systemName;
										// event.preventDefault(); // ğŸ“Œ **é˜²æ­¢é–‹æ–°åˆ†é **

										// displaySystemDetails(selectedSystem, true);
									// }
								// }
							// }

							// // ğŸ“Œ **æ¨¡æ“¬æ»‘é¼ åœç•™**
							// let mouseEvent = new MouseEvent("mousemove", {
								// clientX: touchEndX,
								// clientY: touchEndY,
								// bubbles: true
							// });
							// console.log("x:",touchEndX);
							// console.log("y:",touchEndY);
							// document.dispatchEvent(mouseEvent);
						// });
					// }
				
				})
				.catch(error => console.error("è®€å– system.json éŒ¯èª¤:", error));
		}

		// **ç•¶é é¢è¼‰å…¥æ™‚ï¼Œåˆå§‹åŒ– 3D æ–‡å­—é›²**
		initializeWordCloud();

		// **ç•¶è¦–çª—å¤§å°æ”¹è®Šæ™‚ï¼Œé‡æ–°èª¿æ•´ 3D æ–‡å­—é›²å¤§å°**
		window.addEventListener("resize", function () {
			document.getElementById("word-cloud").innerHTML = ""; // æ¸…é™¤èˆŠçš„ 3D æ–‡å­—é›²
			initializeWordCloud();
		});
		

	});



</script>

</body>
</html>
